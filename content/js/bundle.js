!function t(e,i,r){function n(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[o]={exports:{}};e[o][0].call(p.exports,function(t){var i=e[o][1][t];return n(i?i:t)},p,p.exports,t,e,i,r)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}({1:[function(t,e,i){e.exports={version:"0.0.1"}},{}],2:[function(t,e,i){(function(t){function e(t,e){for(var i=0,r=t.length-1;r>=0;r--){var n=t[r];"."===n?t.splice(r,1):".."===n?(t.splice(r,1),i++):i&&(t.splice(r,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function r(t,e){if(t.filter)return t.filter(e);for(var i=[],r=0;r<t.length;r++)e(t[r],r,t)&&i.push(t[r]);return i}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(t){return n.exec(t).slice(1)};i.resolve=function(){for(var i="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var o=s>=0?arguments[s]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(i=o+"/"+i,n="/"===o.charAt(0))}return i=e(r(i.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+i||"."},i.normalize=function(t){var n=i.isAbsolute(t),s="/"===o(t,-1);return t=e(r(t.split("/"),function(t){return!!t}),!n).join("/"),t||n||(t="."),t&&s&&(t+="/"),(n?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(r(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function r(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var n=r(t.split("/")),s=r(e.split("/")),o=Math.min(n.length,s.length),a=o,h=0;o>h;h++)if(n[h]!==s[h]){a=h;break}for(var u=[],h=a;h<n.length;h++)u.push("..");return u=u.concat(s.slice(a)),u.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=s(t),i=e[0],r=e[1];return i||r?(r&&(r=r.substr(0,r.length-1)),i+r):"."},i.basename=function(t,e){var i=s(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return s(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:3}],3:[function(t,e,i){function r(){p=!1,a.length?u=a.concat(u):c=-1,u.length&&n()}function n(){if(!p){var t=setTimeout(r);p=!0;for(var e=u.length;e;){for(a=u,u=[];++c<e;)a&&a[c].run();c=-1,e=u.length}a=null,p=!1,clearTimeout(t)}}function s(t,e){this.fun=t,this.array=e}function o(){}var a,h=e.exports={},u=[],p=!1,c=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new s(t,e)),1!==u.length||p||setTimeout(n,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=o,h.addListener=o,h.once=o,h.off=o,h.removeListener=o,h.removeAllListeners=o,h.emit=o,h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(t,e,i){var r,n,s,o,a,h,u,p,c,l,f;l=t("path"),f=t("./util"),a=t("./input"),u=t("./unit"),h=t("./team"),n=t("./bullet"),o=t("./brain/human"),r=t("./brain/attacker"),s=t("./brain/defender"),c=t("../content/data/meta"),p=function(){function t(t,e,i){var n,p,c,l,d,m,y,v,g,M,w,x,b,z,T,E,k,A,O,I,C,P,V,S,_,R,F,D,B,H,U,L,G;for(this.container=t,this.viewsize=e,this.size=null!=i?i:32,this.input=new a,this.size2=this.size*this.size,this.gridSize=this.viewsize/this.size,this.resolution=2,this.resolution2=this.resolution*this.resolution,this.sizer=this.size*this.resolution,this.sizer2=this.sizer*this.sizer,this.gridSizer=this.viewsize/this.sizerm,this.field=new Uint8Array(this.size2),this.dismap=new Int32Array(this.size2),C=1,this.team=[],p=[{},{}],c=[{},{}],k="11111111111111111111111111111111\r\n10000000000000001000000000000001\r\n10303000000000001000000000001101\r\n10060000000100000000000010000101\r\n10303000000100000000000010000001\r\n10000000000000001000000110000001\r\n10000033000330001000111111000001\r\n10000030000030000000001111110001\r\n10000000000000001000000110000001\r\n10000000020000001000000100000001\r\n10000000000000001000000100000001\r\n10000030000030001011000000111111\r\n10000033000330001011100000000001\r\n10000000000000011011100000000001\r\n10000000000000011000000000000001\r\n10111110111111111110000000000001\r\n10000000000001111111111101111101\r\n10000000000000011000000000000001\r\n10000000000111011000000000000001\r\n10000000000111010005500055000001\r\n11111100000011010005000005000001\r\n10000000100000010000000000000001\r\n10000000100000010000004000000001\r\n10000001100000010000000000000001\r\n10001111110000000005000005000001\r\n10000011111100010005500055000001\r\n10000001100000010000000000000001\r\n10000001000000000000100000050501\r\n10100001000000000000100000007001\r\n10110000000000010000000000050501\r\n10000000000000010000000000000001\r\n11111111111111111111111111111111",k=k.replace(/\r*\n/g,""),P=this.field,v=g=0,x=P.length;x>g;v=++g)switch(U=P[v],this.field[v]=parseInt(k.charAt(v)),L=v%this.size,G=v/this.size|0,this.field[v]){case 6:p[0]={x:L,y:G};break;case 7:p[1]={x:L,y:G};break;case 2:c[0]={x:L,y:G};break;case 4:c[1]={x:L,y:G}}for(this.team.push(new h(0,p[0],c[0],16752640)),this.team.push(new h(1,p[1],c[1],65535)),V=this.team,v=w=0,b=V.length;b>w;v=++w)for(F=V[v],F.mapsize=this.size,F.mapresolution=this.resolution,F.coredismap=new Int32Array(this.sizer2),F.coredirmap=new Int32Array(this.sizer2),F.enemydismap=new Int32Array(this.sizer2),F.enemydismapUpdate=!0,this.setCoredismap(F,this.team[1-v].core),this.setCoredirmap(F,this.team[1-v].core),A=C===v?3:4,l=C===v?2:1+f.rand(3),M=E=0,S=A;S>=0?S>E:E>S;M=S>=0?++E:--E)n=l>M?new s(F):new r(F),H=new u(v,F.base,n),this.addUnit(H);for(D=this.team[0],B=this.team[1],D.worker=new Worker("./content/js/worker.js"),B.worker=new Worker("./content/js/worker2.js"),D.worker.addEventListener("message",function(t){return D.enemydismap=t.data,D.enemydismapUpdate=!0},!1),B.worker.addEventListener("message",function(t){return B.enemydismap=t.data,B.enemydismapUpdate=!0},!1),_=this.team,v=O=0,z=_.length;z>O;v=++O)F=_[v],this.setEnemydismap(F,this.team[1-v].units);for(R=this.dismap,v=I=0,T=R.length;T>I;v=++I)U=R[v],this.dismap[v]=[0,6,7,8].some(function(t){return function(e){return t.field[v]===e}}(this))?1:-1;this.gField=this.setupField(),this.container.addChild(this.gField),y=new o(this.input),this.player=new u(C,this.team[C].base,y),this.addUnit(this.player),this.marker=this.setupPlayerMarker(this.player),this.container.addChild(this.marker),this.harmonyMarker=this.setupHarmonyMarker(this.player),this.container.addChild(this.harmonyMarker),m=this.setupStartView(),this.container.addChild(m),d=this.setupPauseView(),this.scene={},this.scene.init=function(t){return function(){return function(e){return t.input.keys.z?(t.container.removeChild(m),e("main")):void 0}}}(this),this.scene.main=function(t){return function(){var e;return e=!1,t.input.on("space",function(){return e=!e,e?t.container.addChild(d):t.container.removeChild(d)}),function(i){var r,n,s,o,a;if(!e){for(t.updateUnits(),t.updateBullets(),t.input.keys.o&&t.team[0].changePoint(-100),t.input.keys.p&&t.team[1].changePoint(-100),a=void 0,o=t.team,v=s=0,n=o.length;n>s;v=++s)if(F=o[v],0===F.point){a=v===C?!1:!0;break}return void 0!==a?(t.input.offAll(),r=t.setupResultView(a),t.container.addChild(r),i("result")):void 0}}}}(this),this.scene.result=function(t){return function(){return function(t){}}}(this),this.phase=null,this.transit=function(t){return function(e){return t.phase=t.scene[e]().bind(t,t.transit)}}(this),this.transit("init")}return t.prototype.setCoredismap=function(t,e){var i,r,n,s,o,a,h,u,p,c,l,f,d,m,y,v,g,M,w,x,b,z,T,E,k,A,O,I,C,P,V,S,_,R,F;for(i=t.coredismap,b=[],p=u=0,z=this.resolution;z>=0?z>u:u>z;p=z>=0?++u:--u)for(o=c=0,T=this.resolution;T>=0?T>c:c>T;o=T>=0?++c:--c)b.push({x:e.x*this.resolution+o,y:e.y*this.resolution+p,v:1});for(n=[],E=[-1,0,1],g=0,l=E.length;l>g;g++)for(p=E[g],k=[-1,0,1],M=0,f=k.length;f>M;M++)o=k[M],(0!==o||0!==p)&&n.push([o,p]);for(h=function(t){return function(e,i){var r,n,s,a,h,u,c;for(u=e*t.resolution,c=i*t.resolution,h=[],p=r=0,s=t.resolution;s>=0?s>r:r>s;p=s>=0?++r:--r)for(o=n=0,a=t.resolution;a>=0?a>n:n>a;o=a>=0?++n:--n)h.push(u+o+(c+p)*t.sizer);return h}}(this),A=this.field,o=w=0,d=A.length;d>w;o=++w)if(s=A[o],![0,6,7,8].some(function(t){return function(t){return s===t}}(this)))for(R=o%this.size,F=o/this.size|0,O=h(R,F),x=0,m=O.length;m>x;x++)a=O[x],i[a]=-1;for(;b.length>0;)for(I=b[0],R=I.x,F=I.y,S=I.v,b.splice(0,1),V=0,y=n.length;y>V;V++)r=n[V],a=R+r[0]+(F+r[1])*this.sizer,0===i[a]&&(i[a]=S,b.push({x:R+r[0],y:F+r[1],v:S+1}));for(C=h(e.x,e.y),P=[],_=0,v=C.length;v>_;_++)a=C[_],P.push(i[a]=0);return P},t.prototype.setCoredirmap=function(t,e){var i,r,n,s,o,a,h,u,p,c,l,f,d,m,y,v,g,M,w,x,b,z,T,E;for(i=t.coredirmap,v=[],p=u=0,g=this.resolution;g>=0?g>u:u>g;p=g>=0?++u:--u)v.push({x:e.x*this.resolution+p,y:e.y*this.resolution,dir:3}),v.push({x:e.x*this.resolution+p,y:e.y*this.resolution+this.resolution-1,dir:4}),v.push({x:e.x*this.resolution,y:e.y*this.resolution+p,dir:1}),v.push({x:e.x*this.resolution+this.resolution-1,y:e.y*this.resolution+p,dir:2});for(h=function(t){return function(e,i){var r,n,s,o,a,h,u,c;for(u=e*t.resolution,c=i*t.resolution,h=[],p=n=0,o=t.resolution;o>=0?o>n:n>o;p=o>=0?++n:--n)for(r=s=0,a=t.resolution;a>=0?a>s:s>a;r=a>=0?++s:--s)h.push(u+r+(c+p)*t.sizer);return h}}(this),M=this.field,o=c=0,l=M.length;l>c;o=++c)if(s=M[o],![0,6,7,8].some(function(t){return function(t){return s===t}}(this)))for(T=o%this.size,E=o/this.size|0,w=h(T,E),m=0,f=w.length;f>m;m++)a=w[m],i[a]=-1;for(;v.length>0;)x=v[0],T=x.x,E=x.y,n=x.dir,v.splice(0,1),r=[0,0],r[0]=3>n?2*(n-1)-1:0,r[1]=n>2?2*(n-3)-1:0,a=T+r[0]+(E+r[1])*this.sizer,-1!==i[a]&&(i[a]=n,v.push({x:T+r[0],y:E+r[1],dir:n}));for(b=h(e.x,e.y),z=[],y=0,d=b.length;d>y;y++)a=b[y],z.push(i[a]=0);return z},t.prototype.setEnemydismap=function(t,e){var i,r,n,s,o,a,h,u,p,c,l,d,m,y,v,g,M,w,x,b,z,T,E,k,A,O,I,C,P;if(t.enemydismapUpdate){for(z=t.enemydismap,s=h=0,c=z.length;c>h;s=++h)O=z[s],t.enemydismap[s]=0;for(r=t.enemydismap,b=[],i=[],T=[-1,0,1],p=0,l=T.length;l>p;p++)for(u=T[p],E=[-1,0,1],g=0,d=E.length;d>g;g++)s=E[g],(0!==s||0!==u)&&i.push([s,u]);for(a=function(t){return function(e,i){var r,n,o,a,h,p,c;for(p=e*t.resolution,c=i*t.resolution,h=[],u=r=0,o=t.resolution;o>=0?o>r:r>o;u=o>=0?++r:--r)for(s=n=0,a=t.resolution;a>=0?a>n:n>a;s=a>=0?++n:--n)h.push(p+s+(c+u)*t.sizer);return h}}(this),M=0,m=e.length;m>M;M++)I=e[M],C=Math.ceil(I.i.pos.x*this.resolution),P=Math.ceil(I.i.pos.y*this.resolution),b.push({x:C,y:P,v:1});for(this.getNear(t.core,e,16)||(C=Math.ceil(t.core.x*this.resolution)+f.rand(8)-4,P=Math.ceil(t.core.y*this.resolution)+f.rand(8)-4,b.push({x:C,y:P,v:1})),k=this.field,s=w=0,y=k.length;y>w;s=++w)if(n=k[s],![0,6,7,8].some(function(t){return function(t){return n===t}}(this)))for(C=s%this.size,P=s/this.size|0,A=a(C,P),x=0,v=A.length;v>x;x++)o=A[x],r[o]=-1;return t.enemydismapUpdate=!1,t.worker.postMessage({map:r,queue:b,dir:i,sizer:this.sizer})}},t.prototype.addUnit=function(t){var e,i,r,n,s;return r=t.team,i=this.team[r].base,n=i.x,s=i.y,t.pos.x=n+f.randf(1),t.pos.y=s+f.randf(1),t.ang=r%2?180:0,e=this.setupUnit(t),this.container.addChild(e),this.team[r].units.push({i:t,g:e})},t.prototype.addBullet=function(t){var e,i,r;return r=t.team,e=new n({x:t.pos.x,y:t.pos.y},.2,t.shotang,.1,t),i=this.setupBullet(e),this.container.addChild(i),this.team[r].bullets.push({i:e,g:i})},t.prototype.hitCheck=function(t,e){var i,r,n,s,o,a;return.5>t||.5>e?-2:t>this.size-.5||e>this.size-.5?-2:(n=Math.floor(t-.5)+this.size*Math.floor(e-.5),o=t-.5-Math.floor(t-.5),a=e-.5-Math.floor(e-.5),1e-4>o&&(o=0),1e-4>a&&(a=0),i=[this.dismap[n],this.dismap[n+1],this.dismap[n+this.size],this.dismap[n+this.size+1]],r=[this.field[n],this.field[n+1],this.field[n+this.size],this.field[n+this.size+1]],s=(1-o)*(1-a)*i[0]+(1-o)*a*i[2]+o*(1-a)*i[1]+o*a*i[3],_.remove(r,function(t){return 0===t}),{d:s,f:_.uniq(r)})},t.prototype.fix=function(t){var e,i,r,n,s,o,a,h,u;for(o=t.getCollider(),u=[],r=0,n=o.length;n>r;r++)s=o[r],h=this.hitCheck(s.x,s.y),e=h.d,i=h.f,0>e?(a=(t.ang+180)*Math.PI/180,t.pos.x-=e*Math.cos(a),t.pos.y-=e*Math.sin(a),u.push(t.vel=0)):u.push(void 0);return u},t.prototype.setupText=function(t,e,i,r,n,s,o){var a;switch(a=new PIXI.Text(i,{font:r,fill:n,align:s}),s){case"left":a.position.x=t;break;case"center":a.position.x=t-a.width/2;break;case"right":a.position.x=t-a.width}switch(o){case"top":a.position.y=e;break;case"center":a.position.y=e-a.height/2;break;case"bottom":a.position.y=e-a.height}return a},t.prototype.setupPlayerMarker=function(t){var e,i;return e=new PIXI.Graphics,i=t.size*this.gridSize*5,e.lineStyle(3,16776960).drawRect(-i,-i,2*i,2*i),e.alpha=.4,e},t.prototype.setupHarmonyMarker=function(t){var e,i;return e=new PIXI.Graphics,i=t.size*this.gridSize*5,e.lineStyle(3,3407786).drawRect(-i,-i,2*i,2*i),e.alpha=.4,e.position.x=-50,e.position.y=-50,e},t.prototype.setupStartView=function(){var t,e,i,r,n,s,o;return i=new PIXI.Graphics,i.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),i.alpha=.7,r=this.setupText(this.viewsize/2,this.viewsize/2,"PRESS Z","24px Papyrus",16777215,"center","center"),i.addChild(r),t=(f.rand(256)<<16)+(f.rand(256)<<8)+f.rand(256),n=this.setupText(this.viewsize/2,this.viewsize/4,"harmony","56px Papyrus",t,"center","center"),e=new PIXI.filters.BlurFilter,e.blur=32,n.filters=[e],i.addChild(n),s=this.setupText(this.viewsize/2,this.viewsize/4,"harmony","56px Papyrus",16777215,"center","center"),i.addChild(s),o=this.setupText(this.viewsize,this.viewsize,"version: "+c.version,"16px Papyrus",16777215,"right","bottom"),i.addChild(o),i},t.prototype.setupPauseView=function(){var t,e;return t=new PIXI.Graphics,t.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),t.alpha=.7,e=this.setupText(this.viewsize/2,this.viewsize/2,"Pause","24px Papyrus",16777215,"center","center"),t.addChild(e),t},t.prototype.setupResultView=function(t){var e,i,r,n,s,o,a;return i=new PIXI.filters.BlurFilter,i.blur=24,r=new PIXI.Graphics,r.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),r.alpha=.7,e=t?16776960:65535,n=t?"You Win":"You Lose",s=this.setupText(this.viewsize/2,this.viewsize/2,n,"36px Papyrus",e,"center","center"),r.addChild(s),a=this.setupText(this.viewsize/2,this.viewsize/2,n,"36px Papyrus",e,"center","center"),a.filters=[i],r.addChild(a),o=this.setupText(this.viewsize/2,3*this.viewsize/4,"PRESS ESC or Reload","16px Papyrus",16777215,"center","bottom"),r.addChild(o),r},t.prototype.setupField=function(){var t,e,i,r,n,s,o,a,h,u,p,c,l;for(n=new PIXI.Graphics,s=new PIXI.Graphics,i=new PIXI.filters.BlurFilter,i.blur=7,e=function(t){return function(e,i,r){var o,a,h,u,p,c,l,f,d,m,y;for(l=t.dismap,f=[],h=u=0,p=l.length;p>u;h=++u)if(d=l[h],m=h%t.size,y=h/t.size|0,!(m>t.size-2)){if(y>t.size-2)break;o=[t.dismap[h],t.dismap[h+1],t.dismap[h+t.size],t.dismap[h+t.size+1]],a=[t.field[h],t.field[h+1],t.field[h+t.size],t.field[h+t.size+1]],a.some(function(t){return t===e})&&(c=[],o[0]*o[1]<0&&c.push({x:m+.5,y:y}),o[0]*o[2]<0&&c.push({x:m,y:y+.5}),o[1]*o[3]<0&&c.push({x:m+1,y:y+.5}),o[2]*o[3]<0&&c.push({x:m+.5,y:y+1}),2===c.length&&(n.lineStyle(i,r).moveTo((c[0].x+.5)*t.gridSize,(c[0].y+.5)*t.gridSize).lineTo((c[1].x+.5)*t.gridSize,(c[1].y+.5)*t.gridSize),f.push(s.lineStyle(2*i,r).moveTo((c[0].x+.5)*t.gridSize,(c[0].y+.5)*t.gridSize).lineTo((c[1].x+.5)*t.gridSize,(c[1].y+.5)*t.gridSize))))}return f}}(this),e(1,2,65407),e(2,2,16744192),e(3,2,16723968),e(4,2,41215),e(5,2,20735),r=new PIXI.filters.BlurFilter,r.blur=32,h=this.team,o=0,a=h.length;a>o;o++)p=h[o],u=""+p.point,t=16777215,c=(p.base.x+.5)*this.gridSize,l=(p.base.y+.5)*this.gridSize,p.scoreborad=this.setupText(c,l,u,"36px Papyrus",t,"center","center"),p.scoreborad2=this.setupText(c,l,u,"36px Papyrus",p.color,"center","center"),p.scoreborad2.filters=[r],p.scoreborad.alpha=.7,p.scoreboradUpdate=function(t){return function(){var e;return e=t.gridSize,function(){return c=(this.base.x+.5)*e,l=(this.base.y+.5)*e,this.scoreborad.text=""+this.point,this.scoreborad2.text=this.scoreborad.text,this.scoreborad.position.x=c-this.scoreborad.width/2,this.scoreborad.position.y=l-this.scoreborad.height/2,this.scoreborad2.position=this.scoreborad.position}}}(this)(),n.addChild(p.scoreborad2),n.addChild(p.scoreborad);return n.blendMode=PIXI.BLEND_MODES.ADD,n.alpha=.7,s.filters=[i],n.addChild(s),n},t.prototype.setupBullet=function(t){var e,i,r,n;return e=new PIXI.Graphics,i=t.pos.x*this.gridSize,r=t.pos.y*this.gridSize,n=t.size*this.gridSize,e.lineStyle(1,this.team[t.team].color).drawCircle(0,0,n),e.position.x=i,e.position.y=r,e},t.prototype.setupUnit=function(t){var e,i,r,n,s,o,a,h,u,p,c;return e=new PIXI.Graphics,i=t.pos.x*this.gridSize,r=t.pos.y*this.gridSize,c=t.size*this.gridSize,n=c,s=0,p=-150*Math.PI/180,o=c*Math.cos(p),a=c*Math.sin(p),p=150*Math.PI/180,h=c*Math.cos(p),u=c*Math.sin(p),e.lineStyle(2,this.team[t.team].color).moveTo(n,s).lineTo(o,a).lineTo(0,0).lineTo(h,u).lineTo(n,s),t.scoreborad=this.setupText(i+1.4*c,r-1.4*c,""+t.hp,"14px Papyrus",16777215,"center","center"),t.scoreboradUpdate=function(t){return function(){var e;return e=t.gridSize,function(){return i=this.pos.x*e,r=this.pos.y*e,c=this.size*e,this.scoreborad.text=""+this.hp,this.scoreborad.position.x=i+1.4*c,this.scoreborad.position.y=r-1.4*c}}}(this)(),t.harmonyMarkerUpdate=function(t){return function(){var e;return e=t.gridSize,function(n){return i=n.x*e,r=n.y*e,t.harmonyMarker.position.x=i,t.harmonyMarker.position.y=r}}}(this)(),t.harmonyMarkerRemove=function(t){return function(){var e;return e=t.gridSize,function(){return t.harmonyMarker.position.x=-50,t.harmonyMarker.position.y=-50}}}(this)(),this.container.addChild(t.scoreborad),e.position.x=i,e.position.y=r,e.rotation=t.shotang*Math.PI/180,e},t.prototype.getNear=function(t,e,i){var r,n,s,o,a,h,u,p,c,l;for(r=void 0,o=1e5,n=0,s=e.length;s>n;n++)p=e[n],u=p.i.pos,c=u.x,l=u.y,a=Math.pow(t.x-c,2)+Math.pow(t.y-l,2),a>0&&i*i>a&&o>a&&(h=Math.atan2(l-t.y,c-t.x),r=180*h/Math.PI,o=a);return r},t.prototype.getNear2=function(t,e,i){var r,n,s,o,a,h,u,p,c;for(h=void 0,s=1e5,r=0,n=e.length;n>r;r++)u=e[r],a=u.i.pos,p=a.x,c=a.y,o=Math.pow(t.x-p,2)+Math.pow(t.y-c,2),o>0&&i*i>o&&s>o&&(h=u.i,s=o);return h},t.prototype.updateUnits=function(){var t,e,i,r,n,s,o,a,h,u,p,c;for(a=this.team,h=[],p=e=0,i=a.length;i>e;p=++e)u=a[p],f.rand(8)||this.setEnemydismap(u,this.team[1-p].units),h.push(function(){var e,i,a,h,l,f,d,m,y,v;for(d=u.units,v=[],e=0,i=d.length;i>e;e++){for(c=d[e],c.i.update(function(t){return function(e){return t.addBullet(e)}}(this),function(t){return function(e,i){return t.getNear(e,t.team[1-p].units,i)}}(this),function(t){return function(e,i){return t.getNear2(e,t.team[p].units,i)}}(this)),this.fix(c.i),m=this.team,l=0,a=m.length;a>l;l++)if(u=m[l],c.i.team!==u.id)for(r=c.i.pos,s=3*c.i.size/4,y=u.bullets,f=0,h=y.length;h>f;f++)t=y[f],n=t.i.pos,o=t.i.size,Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2)<Math.pow(s+o,2)&&(t.i.removeflag=!0,c.i.hp--,c.i.scoreboradUpdate());c.g.position.x=c.i.pos.x*this.gridSize,c.g.position.y=c.i.pos.y*this.gridSize,c.g.rotation=c.i.shotang*Math.PI/180,null!=c.i.brain.input?(this.marker.position.x=c.i.pos.x*this.gridSize,v.push(this.marker.position.y=c.i.pos.y*this.gridSize)):v.push(void 0)}return v}.call(this));return h},t.prototype.updateBullets=function(){var t,e,i,r,n,s,o,a,h,u,p,c,l,f,d,m,y,v,g,M,w;for(d=this.team,g=[],n=0,o=d.length;o>n;n++){for(M=d[n],v=[],m=M.bullets,r=s=0,a=m.length;a>s;r=++s){for(t=m[r],t.i.update(),f=t.i.getCollider(),p=0,h=f.length;h>p;p++)if(l=f[p],y=this.hitCheck(l.x,l.y),e=y.d,i=y.f,0>e)for(t.i.removeflag=!0,c=0,u=i.length;u>c;c++)switch(w=i[c]){case 2:if(0===t.i.team)break;this.team[0].changePoint(-1);break;case 4:if(1===t.i.team)break;this.team[1].changePoint(-1)}t.g.position.x=t.i.pos.x*this.gridSize,t.g.position.y=t.i.pos.y*this.gridSize,t.g.rotation=t.i.rad,t.i.removeflag&&(v.push(r),this.container.removeChild(t.g))}g.push(_.remove(M.bullets,function(t,e){return v.some(function(t){return t===e})}))}return g},t.prototype.update=function(){return this.input.keys.esc&&location.reload(),this.phase()},t}(),e.exports=p},{"../content/data/meta":1,"./brain/attacker":7,"./brain/defender":8,"./brain/human":9,"./bullet":10,"./input":11,"./team":14,"./unit":15,"./util":16,path:2}],5:[function(t,e,i){e.exports={IDOL:0,MOVE:{TOP:1,BOTTOM:2,LEFT:3,RIGHT:4},ATTACK:{AIM:5,FOWARD:6},HARMONY:{MASTER:7,SLAVE:8}}},{}],6:[function(t,e,i){var r;r=function(){function t(){}return t.prototype.update=function(t){},t}(),e.exports=r},{}],7:[function(t,e,i){var r,n,s,o,a=function(t,e){function i(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;o=t("../util"),s=t("../brain"),r=t("../actions"),n=function(t){function e(t){this.team=t,e.__super__.constructor.call(this),this.prevacts=[]}return a(e,t),e.prototype.update=function(t,i){var n,s,a,h,u,p,c,l,f,d,m,y,v,g,M,w,x,b,z,T,E,k,A,O,I,C,P,V,S;if(e.__super__.update.call(this,t),o.rand(8))return this.prevacts;for(n=[],l=[],O=[-1,0,1],g=0,x=O.length;x>g;g++)for(M=O[g],I=[-1,0,1],w=0,b=I.length;b>w;w++)m=I[w],(0!==m||0!==M)&&l.push([m,M]);if(C=t.pos,V=C.x,S=C.y,k=Math.ceil((V-.5)*this.team.mapresolution),A=Math.ceil((S-.5)*this.team.mapresolution),u=this.team.coredismap[k+A*this.team.mapsize*this.team.mapresolution],p=this.team.coredirmap[k+A*this.team.mapsize*this.team.mapresolution],p>0)if(a=[0,180,90,270],s=(t.ang+360)%360,s===a[p-1])0===o.rand(5)&&i(t.pos,5)?n.push(r.ATTACK.AIM):n.push(r.ATTACK.FOWARD);else switch(p){case 1:n.push(r.MOVE.RIGHT);break;case 2:n.push(r.MOVE.LEFT);break;case 3:n.push(r.MOVE.BOTTOM);break;case 4:n.push(r.MOVE.TOP)}else if(o.rand(8)){for(E=u,h=[],T=0,z=l.length;z>T;T++)c=l[T],y=k+c[0]+(A+c[1])*this.team.mapsize*this.team.mapresolution,v=k+2*c[0]+(A+2*c[1])*this.team.mapsize*this.team.mapresolution,f=this.team.coredismap[y],d=this.team.coredismap[v],0>f||o.rand(2)&&0>d||(f===E?h.push(c):E>f&&f>2&&(h=[c],E=f));if(0<(P=h.length)&&5>P){switch(c=o.randArray(h),c[0]){case-1:n.push(r.MOVE.LEFT);break;case 1:n.push(r.MOVE.RIGHT)}switch(c[1]){case-1:n.push(r.MOVE.TOP);break;case 1:n.push(r.MOVE.BOTTOM)}i(t.pos,5)&&n.push(r.ATTACK.AIM)}else n.push(o.randArray([r.MOVE.TOP,r.MOVE.BOTTOM,r.MOVE.LEFT,r.MOVE.RIGHT])),n.push(r.ATTACK.AIM)}else n.push(o.randArray([r.MOVE.TOP,r.MOVE.BOTTOM,r.MOVE.LEFT,r.MOVE.RIGHT])),n.push(r.ATTACK.AIM);return this.prevacts=n,n},e}(s),e.exports=n},{"../actions":5,"../brain":6,"../util":16}],8:[function(t,e,i){var r,n,s,o,a=function(t,e){function i(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;o=t("../util"),n=t("../brain"),r=t("../actions"),s=function(t){function e(t){this.team=t,e.__super__.constructor.call(this),this.prevacts=[]}return a(e,t),e.prototype.update=function(t,i){var n,s,a,h,u,p,c,l,f,d,m,y,v,g,M,w,x,b,z,T,E,k,A,O,I,C,P;if(e.__super__.update.call(this,t),o.rand(8))return this.prevacts;for(n=[],c=[],k=[-1,0,1],y=0,M=k.length;M>y;y++)for(v=k[y],A=[-1,0,1],g=0,w=A.length;w>g;g++)d=A[g],(0!==d||0!==v)&&c.push([d,v]);if(O=t.pos,C=O.x,P=O.y,T=Math.ceil((C-.5)*this.team.mapresolution),E=Math.ceil((P-.5)*this.team.mapresolution),f=this.team.enemydismap[T+E*this.team.mapsize*this.team.mapresolution],u=this.team.coredirmap[T+E*this.team.mapsize*this.team.mapresolution],u>0)if(a=[0,180,90,270],s=(t.ang+360)%360,s===a[u-1])o.rand(5)&&i(t.pos)?n.push(r.ATTACK.AIM):n.push(r.ATTACK.FOWARD);else switch(u){case 1:n.push(r.MOVE.RIGHT);break;case 2:n.push(r.MOVE.LEFT);break;case 3:n.push(r.MOVE.BOTTOM);break;case 4:n.push(r.MOVE.TOP)}else if(o.rand(8)&&f>0){for(z=f,h=[],b=0,x=c.length;x>b;b++)p=c[b],m=T+p[0]+(E+p[1])*this.team.mapsize*this.team.mapresolution,l=this.team.enemydismap[m],0>l||(l===z?h.push(p):z>l&&l>1&&(h=[p],z=l));if(0<(I=h.length)&&5>I){switch(6>f?n.push(r.ATTACK.AIM):n.push(r.ATTACK.FOWARD),p=o.randArray(h),p[0]){case-1:n.push(r.MOVE.LEFT);break;case 1:n.push(r.MOVE.RIGHT)}switch(p[1]){case-1:n.push(r.MOVE.TOP);break;case 1:n.push(r.MOVE.BOTTOM)}}else n.push(o.randArray([r.MOVE.TOP,r.MOVE.BOTTOM,r.MOVE.LEFT,r.MOVE.RIGHT])),n.push(r.ATTACK.AIM)}else n.push(o.randArray([r.MOVE.TOP,r.MOVE.BOTTOM,r.MOVE.LEFT,r.MOVE.RIGHT])),n.push(r.ATTACK.AIM);return this.prevacts=n,n},e}(n),e.exports=s},{"../actions":5,"../brain":6,"../util":16}],9:[function(t,e,i){var r,n,s,o=function(t,e){function i(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;n=t("../brain"),r=t("../actions"),s=function(t){function e(t){this.input=t,e.__super__.constructor.call(this)}return o(e,t),e.prototype.update=function(t){var i;return e.__super__.update.call(this,t),i=[],this.input.keys.up&&i.push(r.MOVE.TOP),this.input.keys.down&&i.push(r.MOVE.BOTTOM),this.input.keys.right&&i.push(r.MOVE.RIGHT),this.input.keys.left&&i.push(r.MOVE.LEFT),this.input.keys.x&&i.push(r.HARMONY.MASTER),this.input.keys.z&&this.input.keys.shift?i.push(r.ATTACK.AIM):this.input.keys.z&&i.push(r.ATTACK.FOWARD),i},e}(n),e.exports=s},{"../actions":5,"../brain":6}],10:[function(t,e,i){var r;r=function(){function t(t,e,i,r,n){this.pos=t,this.size=e,this.vel=r,this.parent=n,this.rad=i*Math.PI/180,this.team=this.parent.team,this.r=0}return t.prototype.getCollider=function(){var t,e;return e=45*Math.PI/180,t=[],t.push({x:this.pos.x,y:this.pos.y}),t.push({x:this.pos.x+this.size*Math.cos(this.rad+e),y:this.pos.y+this.size*Math.sin(this.rad+e)}),t.push({x:this.pos.x+this.size*Math.cos(this.rad-e),y:this.pos.y+this.size*Math.sin(this.rad-e)}),t},t.prototype.update=function(){return this.pos.x+=this.vel*Math.cos(this.rad),this.pos.y+=this.vel*Math.sin(this.rad),this.r+=this.vel},t}(),e.exports=r},{}],11:[function(t,e,i){var r,n=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},s={}.hasOwnProperty;r=function(){function t(t){var e,i,r,o,a,h,u,p,c;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},o=function(t){return function(e,i){return{key:t.keyMap[e]||String.fromCharCode(e).toLowerCase(),status:i}}}(this),i=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(e){return o.call(t,e.keyCode,!0)}}(this)),r=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(e){return o.call(t,e.keyCode,!1)}}(this)),i.merge(r).filter(function(t){var e;return e=t.key.charCodeAt(0),e>47&&58>e||e>96&&123>e}).onValue(function(t){return function(e){var i;return t.keys[e.key]=e.status,e.status&&null!=(i=t.listener[e.key])?i.forEach(function(t){return t()}):void 0}}(this)),e=[1,2],a=function(t){return function(i){var r;return r={},e.forEach(function(t){return r[t]=[]}),Bacon.fromEventTarget(t.domElement,i).filter(function(t){var i;return i=t.button,n.call(e,i)>=0}).onValue(function(t){return r[t.button].forEach(function(e){return e(t.clientX,t.clientY)})}),[function(t,e){var i;return null!=(i=r[t])?i.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this),h=a("mousedown"),this.onMouseDown=h[0],this.offMouseDown=h[1],u=a("mouseup"),this.onMouseUp=u[0],this.offMouseUp=u[1],p=_.transform(a("dblclick"),function(t,e){return t.push(e.bind(this,1))}),this.onDoubleClick=p[0],this.offDoubleClick=p[1],c=function(t){return function(){var i,r,n,o;return r={},i={},e.forEach(function(t){return i[t]=!1,r[t]=[]}),n=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),o=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),n.merge(o).onValue(function(t){return null!=i[t[0]]?i[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var e,n,o;n=[];for(e in r)s.call(r,e)&&(o=r[e],n.push(o.forEach(function(r){return i[e]?r(t.clientX,t.clientY):void 0})));return n}),[function(t,e){var i;return null!=(i=r[t])?i.push(e):void 0},function(t,e){return _.remove(r[t],function(t){return null!=e?t===e:!0})}]}}(this)(),this.onMouseMove=c[0],this.offMouseMove=c[1],this.offAll=function(t){return function(){return e.forEach(function(e){return t.offMouseDown(e),t.offMouseUp(e),t.offMouseMove(e)}),t.offDoubleClick(),t.listener={}}}(this)}return t.prototype.on=function(t,e){return this.listener[t]?this.listener[t].push(e):this.listener[t]=[e]},t.prototype.off=function(t,e){return _.remove(this.listener[t],function(t){return t===e})},t}(),e.exports=r},{}],12:[function(t,e,i){"use strict";var r,n,s;n=t("./view"),s=t("./World"),r=function(){function t(){this.view=new n,this.world=new s(this.view.container,this.view.size)}return t.prototype.loop=function(){return requestAnimationFrame(function(t){return function(){return t.loop()}}(this)),this.view.render(function(t){return function(){return t.world.update()}}(this))},t}(),$(function(){return(new r).loop()})},{"./World":4,"./view":17}],13:[function(t,e,i){e.exports={INIT:0,READY:1,ACTIVE:2,DEAD:3}},{}],14:[function(t,e,i){var r;r=function(){function t(t,e,i,r,n){this.id=t,this.base=e,this.core=i,this.color=r,this.point=null!=n?n:100,this.units=[],this.bullets=[]}return t.prototype.changePoint=function(t){return this.point+=t,this.point=Math.max(0,this.point),this.scoreboradUpdate()},t.prototype.eachMembers=function(t){var e,i,r,n,s;for(r=this.units,n=[],e=0,i=r.length;i>e;e++)s=r[e],n.push(t(s));return n},t}(),e.exports=r},{}],15:[function(t,e,i){var r,n,s,o;r=t("./actions"),n=t("./status"),o=t("./util"),s=function(){function t(t,e,i){this.team=t,this.base=e,this.brain=i,this.pos={x:0,y:0},this.ang=this.team%2?180:0,this.shotang=0,this.fullhp=5,this.hp=this.fullhp,this.size=.2,this.vel=0,this.shotInterval=0,this.status=n.ACTIVE,this.respawnCount=0,this.prevHarmony=void 0}return t.prototype.getCollider=function(){var t,e;return t=[],e=this.ang*Math.PI/180,t.push({x:this.pos.x+this.size*Math.cos(e),y:this.pos.y+this.size*Math.sin(e)}),t},t.prototype.action=function(t,e,i,n){var s,o,a,h,u,p,c,l,f,d;for(l=0,a=!1,f=!1,u=!1,h=[void 0,-90,90,void 0,180,-135,135,180,0,-45,45,0,void 0,-90,90,void 0],this.harmony&&(t=this.harmony.filter(function(t){return t!==r.HARMONY.MASTER}),this.harmonyMarkerUpdate(this.pos)),p=0,c=t.length;c>p;p++)switch(o=t[p]){case r.MOVE.TOP:l+=1;break;case r.MOVE.BOTTOM:l+=2;break;case r.MOVE.LEFT:l+=4;break;case r.MOVE.RIGHT:l+=8;break;case r.ATTACK.AIM:a=!0,f=!0;break;case r.ATTACK.FOWARD:f=!0;break;case r.HARMONY.MASTER:u=!0}return u?this.prevHarmony?this.prevHarmony.harmony=t:(d=n(this.pos,32),d.harmony=t,this.prevHarmony=d):this.prevHarmony&&(this.prevHarmony.harmonyMarkerRemove(),this.prevHarmony.harmony=null,this.prevHarmony=void 0),null!=h[l]?(this.ang=h[l],this.vel=a?.03:.06):this.vel=0,this.shotang=this.ang,this.shotInterval>0&&this.shotInterval--,f&&0===this.shotInterval?(a&&(s=i(this.pos,5),s&&(this.shotang=s)),this.shotInterval=20,e(this)):void 0},t.prototype.update=function(t,e,i){var r;switch(this.status){case n.READY:0===this.respawnCount?(this.status=n.ACTIVE,this.pos.x=this.base.x+o.randf(1),this.pos.y=this.base.y+o.randf(1),this.hp=this.fullhp,this.ang=this.team%2?180:0):this.respawnCount--;break;case n.ACTIVE:this.action(this.brain.update(this,e),t,e,i),
r=this.ang*Math.PI/180,this.pos.x+=this.vel*Math.cos(r),this.pos.y+=this.vel*Math.sin(r),this.vel=.7*this.vel,this.vel*this.vel<1e-4&&(this.vel=0),this.hp<=0&&(this.status=n.DEAD);break;case n.DEAD:this.pos.x=-100,this.pos.y=-100,this.status=n.READY,this.respawnCount=180}return this.scoreboradUpdate()},t}(),e.exports=s},{"./actions":5,"./status":13,"./util":16}],16:[function(t,e,i){var r;r=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t}(),e.exports=r},{}],17:[function(t,e,i){var r;r=function(){function t(){var t;this.size=640,this.renderer=PIXI.autoDetectRenderer(this.size,this.size,{backgroundColor:0,antialias:!0}),$(document.body).append(this.renderer.view),t=document.createElement("img"),t.src="content/data/rule.png",t.style.position="absolute",t.style.left="640px",t.style.top="0px",$(document.body).append(t),this.container=new PIXI.Container,this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.right="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement)}return t.prototype.render=function(t){return this.stats.begin(),t(),this.renderer.render(this.container),this.stats.end()},t}(),e.exports=r},{}]},{},[12]);
//# sourceMappingURL=bundle.js.map