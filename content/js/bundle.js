!function t(n,e,i){function r(o,u){if(!e[o]){if(!n[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var c=e[o]={exports:{}};n[o][0].call(c.exports,function(t){var e=n[o][1][t];return r(e?e:t)},c,c.exports,t,n,e,i)}return e[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,n,e){(function(t){function n(t,n){for(var e=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),e++):e&&(t.splice(i,1),e--)}if(n)for(;e--;e)t.unshift("..");return t}function i(t,n){if(t.filter)return t.filter(n);for(var e=[],i=0;i<t.length;i++)n(t[i],i,t)&&e.push(t[i]);return e}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,s=function(t){return r.exec(t).slice(1)};e.resolve=function(){for(var e="",r=!1,s=arguments.length-1;s>=-1&&!r;s--){var o=s>=0?arguments[s]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(e=o+"/"+e,r="/"===o.charAt(0))}return e=n(i(e.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(t){var r=e.isAbsolute(t),s="/"===o(t,-1);return t=n(i(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&s&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,function(t,n){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function i(t){for(var n=0;n<t.length&&""===t[n];n++);for(var e=t.length-1;e>=0&&""===t[e];e--);return n>e?[]:t.slice(n,e-n+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var r=i(t.split("/")),s=i(n.split("/")),o=Math.min(r.length,s.length),u=o,a=0;o>a;a++)if(r[a]!==s[a]){u=a;break}for(var h=[],a=u;a<r.length;a++)h.push("..");return h=h.concat(s.slice(u)),h.join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var n=s(t),e=n[0],i=n[1];return e||i?(i&&(i=i.substr(0,i.length-1)),e+i):"."},e.basename=function(t,n){var e=s(t)[2];return n&&e.substr(-1*n.length)===n&&(e=e.substr(0,e.length-n.length)),e},e.extname=function(t){return s(t)[3]};var o="b"==="ab".substr(-1)?function(t,n,e){return t.substr(n,e)}:function(t,n,e){return 0>n&&(n=t.length+n),t.substr(n,e)}}).call(this,t("_process"))},{_process:2}],2:[function(t,n,e){function i(){c=!1,u.length?h=u.concat(h):f=-1,h.length&&r()}function r(){if(!c){var t=setTimeout(i);c=!0;for(var n=h.length;n;){for(u=h,h=[];++f<n;)u&&u[f].run();f=-1,n=h.length}u=null,c=!1,clearTimeout(t)}}function s(t,n){this.fun=t,this.array=n}function o(){}var u,a=n.exports={},h=[],c=!1,f=-1;a.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var e=1;e<arguments.length;e++)n[e-1]=arguments[e];h.push(new s(t,n)),1!==h.length||c||setTimeout(r,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],3:[function(t,n,e){var i,r,s,o,u,a,h,c=function(t,n){return function(){return t.apply(n,arguments)}};a=t("path"),s=t("./types"),h=t("./util"),r=t("./input"),o=t("./unit"),i=t("./brain/human"),u=function(){function t(t){var n,e,u,a,h,f,l,p,d,v;for(this.size=null!=t?t:32,this.render=c(this.render,this),this.size2=this.size*this.size,this.field=new Uint8Array(this.size2),this.dismap=new Int32Array(this.size2),this.plInfmap=new Float32Array(this.size2),this.enInfmap=new Float32Array(this.size2),l="11111111111111111111111111111111\r\n10000000000000001000000000000001\r\n10303000000000001000000000001101\r\n10000000000100000000000010000101\r\n10303000000100000000000010000001\r\n10000000000000001000000110000001\r\n10000000000000001000111110000001\r\n10000003303300000000001111110001\r\n10000003000300001000000110000001\r\n10000000020000001000000100000001\r\n10000003000300001000000100000001\r\n10000003303300001011000000111111\r\n10000000000000001011100000000001\r\n10000000000000011011100000000001\r\n10000000000000011000000000000001\r\n10111110111111111110000000000001\r\n10000000000001111111111101111101\r\n10000000000000011000000000000001\r\n10000000000111011000000000000001\r\n10000000000111010000000000000001\r\n11111100000011010000550550000001\r\n10000000100000010000500050000001\r\n10000000100000010000004000000001\r\n10000001100000010000500050000001\r\n10001111110000000000550550000001\r\n10000011111100010000000000000001\r\n10000001100000010000000000000001\r\n10000001000000000000100000050501\r\n10100001000000000000100000000001\r\n10110000000000010000000000050501\r\n10000000000000010000000000000001\r\n11111111111111111111111111111111",l=l.replace(/\r*\n/g,""),p=this.field,e=u=0,h=p.length;h>u;e=++u)v=p[e],this.field[e]=parseInt(l.charAt(e));for(d=this.dismap,e=a=0,f=d.length;f>a;e=++a)v=d[e],this.dismap[e]=0===this.field[e]?1:-1;this.input=new r,n=new i(this.input),this.player=new o(this.size/2,this.size/2,s.UNIT.PLAYER,n)}return t.prototype.hitCheck=function(t,n){var e,i,r,s;return.5>t||.5>n?-2:t>this.size-.5||n>this.size-.5?-2:(i=Math.floor(t-.5)+this.size*Math.floor(n-.5),r=t-.5-Math.floor(t-.5),s=n-.5-Math.floor(n-.5),1e-4>r&&(r=0),1e-4>s&&(s=0),e=[this.dismap[i],this.dismap[i+1],this.dismap[i+this.size],this.dismap[i+this.size+1]],(1-r)*(1-s)*e[0]+(1-r)*s*e[2]+r*(1-s)*e[1]+r*s*e[3])},t.prototype.fix=function(t){var n,e,i,r,s,o,u;for(s=t.getCollider(),u=[],e=0,i=s.length;i>e;e++)r=s[e],n=this.hitCheck(r.x,r.y),0>n?(o=(t.ang+180)*Math.PI/180,t.pos.x-=n*Math.cos(o),t.pos.y-=n*Math.sin(o),u.push(t.vel=0)):u.push(void 0);return u},t.prototype.drawGrid=function(t,n){var e,i,r,s,o,u,a;for(t.strokeStyle="rgb(92, 92, 92)",u=e=0,r=this.size;r>=0?r>e:e>r;u=r>=0?++e:--e)t.beginPath(),t.moveTo(u*this.gridSize,0),t.lineTo(u*this.gridSize,n),t.stroke();for(o=[],a=i=0,s=this.size;s>=0?s>i:i>s;a=s>=0?++i:--i)t.beginPath(),t.moveTo(0,a*this.gridSize),t.lineTo(n,a*this.gridSize),o.push(t.stroke());return o},t.prototype.drawField=function(t){var n;return n=function(n){return function(e,i){var r,s,o,u,a,h,c,f,l,p;for(t.strokeStyle=i,t.beginPath(),c=n.dismap,o=u=0,a=c.length;a>u;o=++u)if(f=c[o],l=o%n.size,p=o/n.size|0,!(l>n.size-2)){if(p>n.size-2)break;r=[n.dismap[o],n.dismap[o+1],n.dismap[o+n.size],n.dismap[o+n.size+1]],s=[n.field[o],n.field[o+1],n.field[o+n.size],n.field[o+n.size+1]],s.some(function(t){return t===e})&&(h=[],r[0]*r[1]<0&&h.push({x:l+.5,y:p}),r[0]*r[2]<0&&h.push({x:l,y:p+.5}),r[1]*r[3]<0&&h.push({x:l+1,y:p+.5}),r[2]*r[3]<0&&h.push({x:l+.5,y:p+1}),2===h.length&&(t.moveTo((h[0].x+.5)*n.gridSize,(h[0].y+.5)*n.gridSize),t.lineTo((h[1].x+.5)*n.gridSize,(h[1].y+.5)*n.gridSize)))}return t.stroke()}}(this),n(1,"rgb(0, 255, 128)"),n(2,"rgb(255, 128, 0)"),n(3,"rgb(255, 48, 0)"),n(4,"rgb(0, 160, 255)"),n(5,"rgb(0, 92, 255)")},t.prototype.drawUnit=function(t,n){var e,i,r,s,o,u,a,h,c,f;return t.strokeStyle="rgb(0, 255, 255)",t.fillStyle="rgb(0, 0, 0)",t.beginPath(),t.lineWidth=2,e=n.pos.x*this.gridSize,i=n.pos.y*this.gridSize,f=n.size*this.gridSize,c=n.ang*Math.PI/180,r=e+f*Math.cos(c),s=i+f*Math.sin(c),c=(n.ang-150)*Math.PI/180,o=e+f*Math.cos(c),u=i+f*Math.sin(c),c=(n.ang+150)*Math.PI/180,a=e+f*Math.cos(c),h=i+f*Math.sin(c),c=n.ang*Math.PI/180,t.moveTo(r,s),t.lineTo(o,u),t.lineTo(e,i),t.lineTo(a,h),t.lineTo(r,s),t.fill(),t.stroke()},t.prototype.update=function(){return this.player.update(),this.fix(this.player)},t.prototype.render=function(t,n){return this.gridSize=n/this.size,this.drawField(t),this.drawUnit(t,this.player)},t}(),n.exports=u},{"./brain/human":6,"./input":7,"./types":9,"./unit":10,"./util":11,path:1}],4:[function(t,n,e){n.exports={MOVE:{TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},ATTACK:{AIM:7,FOWARD:8}}},{}],5:[function(t,n,e){var i;i=function(){function t(){}return t.prototype.update=function(t){},t}(),n.exports=i},{}],6:[function(t,n,e){var i,r,s,o=function(t,n){function e(){this.constructor=t}for(var i in n)u.call(n,i)&&(t[i]=n[i]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},u={}.hasOwnProperty;r=t("../brain"),i=t("../actions"),s=function(t){function n(t){this.input=t,n.__super__.constructor.call(this)}return o(n,t),n.prototype.update=function(t){var e;return n.__super__.update.call(this,t),e=[],this.input.keys.up&&e.push(i.MOVE.TOP),this.input.keys.down&&e.push(i.MOVE.BOTTOM),this.input.keys.right&&e.push(i.MOVE.RIGHT),this.input.keys.left&&e.push(i.MOVE.LEFT),this.input.keys.z&&e.push(i.ATTACK.AIM),e},n}(r),n.exports=s},{"../actions":4,"../brain":5}],7:[function(t,n,e){var i,r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},s={}.hasOwnProperty;i=function(){function t(t){var n,e,i,o,u,a,h,c,f;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},o=function(t){return function(n,e){return{key:t.keyMap[n]||String.fromCharCode(n).toLowerCase(),status:e}}}(this),e=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(n){return o.call(t,n.keyCode,!0)}}(this)),i=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(n){return o.call(t,n.keyCode,!1)}}(this)),e.merge(i).filter(function(t){var n;return n=t.key.charCodeAt(0),n>47&&58>n||n>96&&123>n}).onValue(function(t){return function(n){var e;return t.keys[n.key]=n.status,n.status&&null!=(e=t.listener[n.key])?e.forEach(function(t){return t()}):void 0}}(this)),n=[1,2],u=function(t){return function(e){var i;return i={},n.forEach(function(t){return i[t]=[]}),Bacon.fromEventTarget(t.domElement,e).filter(function(t){var e;return e=t.button,r.call(n,e)>=0}).onValue(function(t){return i[t.button].forEach(function(n){return n(t.clientX,t.clientY)})}),[function(t,n){var e;return null!=(e=i[t])?e.push(n):void 0},function(t,n){return _.remove(i[t],function(t){return null!=n?t===n:!0})}]}}(this),a=u("mousedown"),this.onMouseDown=a[0],this.offMouseDown=a[1],h=u("mouseup"),this.onMouseUp=h[0],this.offMouseUp=h[1],c=_.transform(u("dblclick"),function(t,n){return t.push(n.bind(this,1))}),this.onDoubleClick=c[0],this.offDoubleClick=c[1],f=function(t){return function(){var e,i,r,o;return i={},e={},n.forEach(function(t){return e[t]=!1,i[t]=[]}),r=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),o=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),r.merge(o).onValue(function(t){return null!=e[t[0]]?e[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var n,r,o;r=[];for(n in i)s.call(i,n)&&(o=i[n],r.push(o.forEach(function(i){return e[n]?i(t.clientX,t.clientY):void 0})));return r}),[function(t,n){var e;return null!=(e=i[t])?e.push(n):void 0},function(t,n){return _.remove(i[t],function(t){return null!=n?t===n:!0})}]}}(this)(),this.onMouseMove=f[0],this.offMouseMove=f[1],this.offAll=function(t){return function(){var e,i,r,o;n.forEach(function(n){return t.offMouseDown(n),t.offMouseUp(n),t.offMouseMove(n)}),t.offDoubleClick(),i=t.listener,r=[];for(e in i)s.call(i,e)&&(o=i[e],r.push(t.off(e)));return r}}(this)}return t.prototype.on=function(t,n){return this.listener[t]?this.listener[t].push(n):this.listener[t]=[n]},t.prototype.off=function(t,n){return null==n&&(n=allremove),_.remove(this.listener[t],function(t){return t===n})},t}(),n.exports=i},{}],8:[function(t,n,e){"use strict";var i,r,s;r=t("./view"),s=t("./World"),i=function(){function t(){this.view=new r,this.world=new s}return t.prototype.loop=function(){return requestAnimationFrame(function(t){return function(){return t.loop()}}(this)),this.world.update(),this.view.render(this.world.render)},t}(),$(function(){return(new i).loop()})},{"./World":3,"./view":12}],9:[function(t,n,e){n.exports={UNIT:{PLAYER:0,FELLOW:1,ENEMY:2}}},{}],10:[function(t,n,e){var i,r,s;r=t("./types"),i=t("./actions"),s=function(){function t(t,n,e,i){this.type=e,this.brain=i,this.pos={x:t,y:n},this.ang=0,this.shotang=0,this.size=.2,this.vel=0}return t.prototype.getCollider=function(){var t,n;return t=[],n=this.ang*Math.PI/180,t.push({x:this.pos.x+this.size*Math.cos(n),y:this.pos.y+this.size*Math.sin(n)}),t},t.prototype.action=function(t){var n,e,r,s,o,u,a;for(u=0,e=!1,a=!1,r=[void 0,-90,90,void 0,180,-135,135,180,0,-45,45,0,void 0,-90,90,void 0],s=0,o=t.length;o>s;s++)switch(n=t[s]){case i.MOVE.TOP:u+=1;break;case i.MOVE.BOTTOM:u+=2;break;case i.MOVE.LEFT:u+=4;break;case i.MOVE.RIGHT:u+=8;break;case i.ATTACK.AIM:e=!0,a=!0;break;case i.ATTACK.FOWARD:a=!0}return null!=r[u]?(this.ang=r[u],this.vel=e?.04:.07):this.vel=0,a?0:void 0},t.prototype.update=function(){var t;return this.action(this.brain.update(this)),t=this.ang*Math.PI/180,this.pos.x+=this.vel*Math.cos(t),this.pos.y+=this.vel*Math.sin(t),this.vel=.7*this.vel,this.vel*this.vel<1e-4?this.vel=0:void 0},t.prototype.draw=function(t){var n,e,i,r,s,o,u;return t.strokeStyle="rgb(0, 92, 192)",t.beginPath(),u=this.ang*Math.PI/180,n=this.pos.x+this.size*Math.cos(u),e=this.pos.y+this.size*Math.sin(u),u=(this.ang-60)*Math.PI/180,i=this.pos.x+this.size*Math.cos(u),r=this.pos.y+this.size*Math.sin(u),u=(this.ang+60)*Math.PI/180,s=this.pos.x+this.size*Math.cos(u),o=this.pos.y+this.size*Math.sin(u),u=this.ang*Math.PI/180,t.moveTo(n,e),t.lineTo(i,r),t.lineTo(this.pos.x,this.pos.y),t.lineTo(s,o),t.lineTo(n,e),t.stroke()},t}(),n.exports=s},{"./actions":4,"./types":9}],11:[function(t,n,e){var i;i=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,n){return Math.floor(Math.random()*(n-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t}(),n.exports=i},{}],12:[function(t,n,e){var i;i=function(){function t(){this.canvas=document.getElementById("view"),this.backcanvas=document.createElement("canvas"),this.backcanvas.style.visibility="hidden",this.ctx=this.canvas.getContext("2d"),this.backctx=this.backcanvas.getContext("2d"),this.update(),$(window).resize(function(t){return function(){return t.update()}}(this)),this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.left="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement)}return t.prototype.update=function(){var t,n;return n=window.innerWidth,t=window.innerHeight,this.viewSize=Math.min(n,t),this.canvas.width=this.viewSize,this.canvas.height=this.viewSize,this.backcanvas.width=this.viewSize,this.backcanvas.height=this.viewSize},t.prototype.render=function(t){return this.stats.begin(),this.backctx.clearRect(0,0,this.backcanvas.width,this.backcanvas.height),this.backctx.fillStyle="black",this.backctx.fillRect(0,0,this.viewSize,this.viewSize),this.backctx.fill(),t(this.backctx,this.viewSize),this.ctx.drawImage(this.backcanvas,0,0),this.stats.end()},t}(),n.exports=i},{}]},{},[8]);
//# sourceMappingURL=bundle.js.map