!function t(e,i,s){function n(o,h){if(!i[o]){if(!e[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[o]={exports:{}};e[o][0].call(p.exports,function(t){var i=e[o][1][t];return n(i?i:t)},p,p.exports,t,e,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e,i){e.exports={version:"0.0.1"}},{}],2:[function(t,e,i){(function(t){function e(t,e){for(var i=0,s=t.length-1;s>=0;s--){var n=t[s];"."===n?t.splice(s,1):".."===n?(t.splice(s,1),i++):i&&(t.splice(s,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function s(t,e){if(t.filter)return t.filter(e);for(var i=[],s=0;s<t.length;s++)e(t[s],s,t)&&i.push(t[s]);return i}var n=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,r=function(t){return n.exec(t).slice(1)};i.resolve=function(){for(var i="",n=!1,r=arguments.length-1;r>=-1&&!n;r--){var o=r>=0?arguments[r]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(i=o+"/"+i,n="/"===o.charAt(0))}return i=e(s(i.split("/"),function(t){return!!t}),!n).join("/"),(n?"/":"")+i||"."},i.normalize=function(t){var n=i.isAbsolute(t),r="/"===o(t,-1);return t=e(s(t.split("/"),function(t){return!!t}),!n).join("/"),t||n||(t="."),t&&r&&(t+="/"),(n?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(s(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function s(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var n=s(t.split("/")),r=s(e.split("/")),o=Math.min(n.length,r.length),h=o,a=0;o>a;a++)if(n[a]!==r[a]){h=a;break}for(var u=[],a=h;a<n.length;a++)u.push("..");return u=u.concat(r.slice(h)),u.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=r(t),i=e[0],s=e[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},i.basename=function(t,e){var i=r(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return r(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:3}],3:[function(t,e,i){function s(){p=!1,h.length?u=h.concat(u):c=-1,u.length&&n()}function n(){if(!p){var t=setTimeout(s);p=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length}h=null,p=!1,clearTimeout(t)}}function r(t,e){this.fun=t,this.array=e}function o(){}var h,a=e.exports={},u=[],p=!1,c=-1;a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new r(t,e)),1!==u.length||p||setTimeout(n,0)},r.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=o,a.addListener=o,a.once=o,a.off=o,a.removeListener=o,a.removeAllListeners=o,a.emit=o,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(t,e,i){var s,n,r,o,h,a,u,p,c,l,f;l=t("path"),f=t("./util"),h=t("./input"),u=t("./unit"),a=t("./team"),n=t("./bullet"),o=t("./brain/human"),s=t("./brain/attacker"),r=t("./brain/defender"),c=t("../content/data/meta"),p=function(){function t(t,e,i){var n,p,c,l,d,m,y,v,g,b,x,M,w,z,T,E,O,A,I,C,k,P,V,_,S,F,R,B,D,L,G;for(this.container=t,this.viewsize=e,this.size=null!=i?i:32,this.input=new h,this.size2=this.size*this.size,this.gridSize=this.viewsize/this.size,this.resolution=2,this.resolution2=this.resolution*this.resolution,this.sizer=this.size*this.resolution,this.sizer2=this.sizer*this.sizer,this.gridSizer=this.viewsize/this.sizerm,this.field=new Uint8Array(this.size2),this.dismap=new Int32Array(this.size2),k=1,this.team=[],p=[{},{}],c=[{},{}],O="11111111111111111111111111111111\r\n10000000000000001000000000000001\r\n10303000000000001000000000001101\r\n10060000000100000000000010000101\r\n10303000000100000000000010000001\r\n10000000000000001000000110000001\r\n10000033000330001000111111000001\r\n10000030000030000000001111110001\r\n10000000000000001000000110000001\r\n10000000020000001000000100000001\r\n10000000000000001000000100000001\r\n10000030000030001011000000111111\r\n10000033000330001011100000000001\r\n10000000000000011011100000000001\r\n10000000000000011000000000000001\r\n10111110111111111110000000000001\r\n10000000000001111111111101111101\r\n10000000000000011000000000000001\r\n10000000000111011000000000000001\r\n10000000000111010005500055000001\r\n11111100000011010005000005000001\r\n10000000100000010000000000000001\r\n10000000100000010000004000000001\r\n10000001100000010000000000000001\r\n10001111110000000005000005000001\r\n10000011111100010005500055000001\r\n10000001100000010000000000000001\r\n10000001000000000000100000050501\r\n10100001000000000000100000007001\r\n10110000000000010000000000050501\r\n10000000000000010000000000000001\r\n11111111111111111111111111111111",O=O.replace(/\r*\n/g,""),P=this.field,v=g=0,M=P.length;M>g;v=++g)switch(D=P[v],this.field[v]=parseInt(O.charAt(v)),L=v%this.size,G=v/this.size|0,this.field[v]){case 6:p[0]={x:L,y:G};break;case 7:p[1]={x:L,y:G};break;case 2:c[0]={x:L,y:G};break;case 4:c[1]={x:L,y:G}}for(this.team.push(new a(0,p[0],c[0],16752640)),this.team.push(new a(1,p[1],c[1],65535)),V=this.team,v=x=0,w=V.length;w>x;v=++x)for(R=V[v],R.mapsize=this.size,R.mapresolution=this.resolution,R.coredismap=new Int32Array(this.sizer2),R.coredirmap=new Int32Array(this.sizer2),R.enemydismap=new Int32Array(this.sizer2),this.setCoredismap(R,this.team[1-v].core),this.setCoredirmap(R,this.team[1-v].core),A=k===v?3:4,l=f.rand(A/2+1)+1,b=E=0,_=A;_>=0?_>E:E>_;b=_>=0?++E:--E)n=l>b?new r(R):new s(R),B=new u(v,R.base,n),this.addUnit(B);for(S=this.team,v=I=0,z=S.length;z>I;v=++I)R=S[v],this.setEnemydismap(R,this.team[1-v].units);for(F=this.dismap,v=C=0,T=F.length;T>C;v=++C)D=F[v],this.dismap[v]=[0,6,7,8].some(function(t){return function(e){return t.field[v]===e}}(this))?1:-1;this.gField=this.setupField(),this.container.addChild(this.gField),y=new o(this.input),this.player=new u(k,this.team[k].base,y),this.addUnit(this.player),m=this.setupStartView(),this.container.addChild(m),d=this.setupPauseView(),this.scene={},this.scene.init=function(t){return function(){return function(e){return t.input.keys.z?(t.container.removeChild(m),e("main")):void 0}}}(this),this.scene.main=function(t){return function(){var e;return e=!1,t.input.on("space",function(){return e=!e,e?t.container.addChild(d):t.container.removeChild(d)}),function(i){var s,n,r,o,h;if(!e){for(t.updateUnits(),t.updateBullets(),t.input.keys.o&&t.team[0].changePoint(-100),t.input.keys.p&&t.team[1].changePoint(-100),h=void 0,o=t.team,v=r=0,n=o.length;n>r;v=++r)if(R=o[v],0===R.point){h=v===k?!1:!0;break}return void 0!==h?(t.input.offAll(),s=t.setupResultView(h),t.container.addChild(s),i("result")):void 0}}}}(this),this.scene.result=function(t){return function(){return function(t){}}}(this),this.phase=null,this.transit=function(t){return function(e){return t.phase=t.scene[e]().bind(t,t.transit)}}(this),this.transit("init")}return t.prototype.setCoredismap=function(t,e){var i,s,n,r,o,h,a,u,p,c,l,f,d,m,y,v,g,b,x,M,w,z,T,E,O,A,I,C,k,P,V,_,S,F,R;for(i=t.coredismap,w=[],p=u=0,T=this.resolution;T>=0?T>u:u>T;p=T>=0?++u:--u)for(o=c=0,E=this.resolution;E>=0?E>c:c>E;o=E>=0?++c:--c)w.push({x:e.x*this.resolution+o,y:e.y*this.resolution+p,v:1});for(n=[],O=[-1,0,1],g=0,l=O.length;l>g;g++)for(p=O[g],A=[-1,0,1],b=0,f=A.length;f>b;b++)o=A[b],(0!==o||0!==p)&&n.push([o,p]);for(a=function(t){return function(e,i){var s,n,r,h,a,u,c;for(u=e*t.resolution,c=i*t.resolution,a=[],p=s=0,r=t.resolution;r>=0?r>s:s>r;p=r>=0?++s:--s)for(o=n=0,h=t.resolution;h>=0?h>n:n>h;o=h>=0?++n:--n)a.push(u+o+(c+p)*t.sizer);return a}}(this),I=this.field,o=x=0,d=I.length;d>x;o=++x)if(r=I[o],![0,6,7,8].some(function(t){return function(t){return r===t}}(this)))for(F=o%this.size,R=o/this.size|0,C=a(F,R),M=0,m=C.length;m>M;M++)h=C[M],i[h]=-1;for(;w.length>0;)for(k=w[0],F=k.x,R=k.y,S=k.v,w.splice(0,1),z=0,y=n.length;y>z;z++)s=n[z],h=F+s[0]+(R+s[1])*this.sizer,0===i[h]&&(i[h]=S,w.push({x:F+s[0],y:R+s[1],v:S+1}));for(P=a(e.x,e.y),V=[],_=0,v=P.length;v>_;_++)h=P[_],V.push(i[h]=0);return V},t.prototype.setCoredirmap=function(t,e){var i,s,n,r,o,h,a,u,p,c,l,f,d,m,y,v,g,b,x,M,w,z,T,E;for(i=t.coredirmap,v=[],p=u=0,g=this.resolution;g>=0?g>u:u>g;p=g>=0?++u:--u)v.push({x:e.x*this.resolution+p,y:e.y*this.resolution,dir:3}),v.push({x:e.x*this.resolution+p,y:e.y*this.resolution+this.resolution-1,dir:4}),v.push({x:e.x*this.resolution,y:e.y*this.resolution+p,dir:1}),v.push({x:e.x*this.resolution+this.resolution-1,y:e.y*this.resolution+p,dir:2});for(a=function(t){return function(e,i){var s,n,r,o,h,a,u,c;for(u=e*t.resolution,c=i*t.resolution,a=[],p=n=0,o=t.resolution;o>=0?o>n:n>o;p=o>=0?++n:--n)for(s=r=0,h=t.resolution;h>=0?h>r:r>h;s=h>=0?++r:--r)a.push(u+s+(c+p)*t.sizer);return a}}(this),b=this.field,o=c=0,l=b.length;l>c;o=++c)if(r=b[o],![0,6,7,8].some(function(t){return function(t){return r===t}}(this)))for(T=o%this.size,E=o/this.size|0,x=a(T,E),m=0,f=x.length;f>m;m++)h=x[m],i[h]=-1;for(;v.length>0;)M=v[0],T=M.x,E=M.y,n=M.dir,v.splice(0,1),s=[0,0],s[0]=3>n?2*(n-1)-1:0,s[1]=n>2?2*(n-3)-1:0,h=T+s[0]+(E+s[1])*this.sizer,-1!==i[h]&&(i[h]=n,v.push({x:T+s[0],y:E+s[1],dir:n}));for(w=a(e.x,e.y),z=[],y=0,d=w.length;d>y;y++)h=w[y],z.push(i[h]=0);return z},t.prototype.setEnemydismap=function(t,e){var i,s,n,r,o,h,a,u,p,c,l,d,m,y,v,g,b,x,M,w,z,T,E,O,A,I,C,k,P,V,_,S,F;for(T=t.enemydismap,o=u=0,l=T.length;l>u;o=++u)P=T[o],t.enemydismap[o]=0;for(n=t.enemydismap,z=[],s=[],E=[-1,0,1],c=0,d=E.length;d>c;c++)for(p=E[c],O=[-1,0,1],b=0,m=O.length;m>b;b++)o=O[b],(0!==o||0!==p)&&s.push([o,p]);for(a=function(t){return function(e,i){var s,n,r,h,a,u,c;for(u=e*t.resolution,c=i*t.resolution,a=[],p=s=0,r=t.resolution;r>=0?r>s:s>r;p=r>=0?++s:--s)for(o=n=0,h=t.resolution;h>=0?h>n:n>h;o=h>=0?++n:--n)a.push(u+o+(c+p)*t.sizer);return a}}(this),x=0,y=e.length;y>x;x++)V=e[x],S=Math.ceil(V.i.pos.x*this.resolution),F=Math.ceil(V.i.pos.y*this.resolution),z.push({x:S,y:F,v:1});for(S=Math.ceil(t.core.x*this.resolution)+f.rand(8)-4,F=Math.ceil(t.core.y*this.resolution)+f.rand(8)-4,z.push({x:S,y:F,v:1}),A=this.field,o=M=0,v=A.length;v>M;o=++M)if(r=A[o],![0,6,7,8].some(function(t){return function(t){return r===t}}(this)))for(S=o%this.size,F=o/this.size|0,I=a(S,F),w=0,g=I.length;g>w;w++)h=I[w],n[h]=-1;for(k=[];z.length>0;)C=z[0],S=C.x,F=C.y,_=C.v,z.splice(0,1),k.push(function(){var t,e,r;for(r=[],e=0,t=s.length;t>e;e++)i=s[e],h=S+i[0]+(F+i[1])*this.sizer,0===n[h]&&(n[h]=_,_>20||r.push(z.push({x:S+i[0],y:F+i[1],v:_+1})));return r}.call(this));return k},t.prototype.addUnit=function(t){var e,i,s,n,r;return s=t.team,i=this.team[s].base,n=i.x,r=i.y,t.pos.x=n+f.randf(1),t.pos.y=r+f.randf(1),t.ang=s%2?180:0,e=this.setupUnit(t),this.container.addChild(e),this.team[s].units.push({i:t,g:e})},t.prototype.addBullet=function(t){var e,i,s;return s=t.team,e=new n({x:t.pos.x,y:t.pos.y},.2,t.shotang,.1,t),i=this.setupBullet(e),this.container.addChild(i),this.team[s].bullets.push({i:e,g:i})},t.prototype.hitCheck=function(t,e){var i,s,n,r,o,h;return.5>t||.5>e?-2:t>this.size-.5||e>this.size-.5?-2:(n=Math.floor(t-.5)+this.size*Math.floor(e-.5),o=t-.5-Math.floor(t-.5),h=e-.5-Math.floor(e-.5),1e-4>o&&(o=0),1e-4>h&&(h=0),i=[this.dismap[n],this.dismap[n+1],this.dismap[n+this.size],this.dismap[n+this.size+1]],s=[this.field[n],this.field[n+1],this.field[n+this.size],this.field[n+this.size+1]],r=(1-o)*(1-h)*i[0]+(1-o)*h*i[2]+o*(1-h)*i[1]+o*h*i[3],_.remove(s,function(t){return 0===t}),{d:r,f:_.uniq(s)})},t.prototype.fix=function(t){var e,i,s,n,r,o,h,a,u;for(o=t.getCollider(),u=[],s=0,n=o.length;n>s;s++)r=o[s],a=this.hitCheck(r.x,r.y),e=a.d,i=a.f,0>e?(h=(t.ang+180)*Math.PI/180,t.pos.x-=e*Math.cos(h),t.pos.y-=e*Math.sin(h),u.push(t.vel=0)):u.push(void 0);return u},t.prototype.setupText=function(t,e,i,s,n,r,o){var h;switch(h=new PIXI.Text(i,{font:s,fill:n,align:r}),r){case"left":h.position.x=t;break;case"center":h.position.x=t-h.width/2;break;case"right":h.position.x=t-h.width}switch(o){case"top":h.position.y=e;break;case"center":h.position.y=e-h.height/2;break;case"bottom":h.position.y=e-h.height}return h},t.prototype.setupStartView=function(){var t,e,i,s,n,r,o;return i=new PIXI.Graphics,i.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),i.alpha=.7,s=this.setupText(this.viewsize/2,this.viewsize/2,"PRESS Z","24px Papyrus",16777215,"center","center"),i.addChild(s),t=(f.rand(256)<<16)+(f.rand(256)<<8)+f.rand(256),n=this.setupText(this.viewsize/2,this.viewsize/4,"harmony","56px Papyrus",t,"center","center"),e=new PIXI.filters.BlurFilter,e.blur=32,n.filters=[e],i.addChild(n),r=this.setupText(this.viewsize/2,this.viewsize/4,"harmony","56px Papyrus",16777215,"center","center"),i.addChild(r),o=this.setupText(this.viewsize,this.viewsize,"version: "+c.version,"16px Papyrus",16777215,"right","bottom"),i.addChild(o),i},t.prototype.setupPauseView=function(){var t,e;return t=new PIXI.Graphics,t.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),t.alpha=.7,e=this.setupText(this.viewsize/2,this.viewsize/2,"Pause","24px Papyrus",16777215,"center","center"),t.addChild(e),t},t.prototype.setupResultView=function(t){var e,i,s,n,r,o,h;return i=new PIXI.filters.BlurFilter,i.blur=24,s=new PIXI.Graphics,s.lineStyle(0).beginFill(3355443).drawRect(0,0,this.viewsize,this.viewsize).endFill(),s.alpha=.7,e=t?16776960:65535,n=t?"You Win":"You Lose",r=this.setupText(this.viewsize/2,this.viewsize/2,n,"36px Papyrus",e,"center","center"),s.addChild(r),h=this.setupText(this.viewsize/2,this.viewsize/2,n,"36px Papyrus",e,"center","center"),h.filters=[i],s.addChild(h),o=this.setupText(this.viewsize/2,3*this.viewsize/4,"PRESS ESC or Reload","16px Papyrus",16777215,"center","bottom"),s.addChild(o),s},t.prototype.setupField=function(){var t,e,i,s,n,r,o,h,a,u,p,c,l;for(n=new PIXI.Graphics,r=new PIXI.Graphics,i=new PIXI.filters.BlurFilter,i.blur=7,e=function(t){return function(e,i,s){var o,h,a,u,p,c,l,f,d,m,y;for(l=t.dismap,f=[],a=u=0,p=l.length;p>u;a=++u)if(d=l[a],m=a%t.size,y=a/t.size|0,!(m>t.size-2)){if(y>t.size-2)break;o=[t.dismap[a],t.dismap[a+1],t.dismap[a+t.size],t.dismap[a+t.size+1]],h=[t.field[a],t.field[a+1],t.field[a+t.size],t.field[a+t.size+1]],h.some(function(t){return t===e})&&(c=[],o[0]*o[1]<0&&c.push({x:m+.5,y:y}),o[0]*o[2]<0&&c.push({x:m,y:y+.5}),o[1]*o[3]<0&&c.push({x:m+1,y:y+.5}),o[2]*o[3]<0&&c.push({x:m+.5,y:y+1}),2===c.length&&(n.lineStyle(i,s).moveTo((c[0].x+.5)*t.gridSize,(c[0].y+.5)*t.gridSize).lineTo((c[1].x+.5)*t.gridSize,(c[1].y+.5)*t.gridSize),f.push(r.lineStyle(2*i,s).moveTo((c[0].x+.5)*t.gridSize,(c[0].y+.5)*t.gridSize).lineTo((c[1].x+.5)*t.gridSize,(c[1].y+.5)*t.gridSize))))}return f}}(this),e(1,2,65407),e(2,2,16744192),e(3,2,16723968),e(4,2,41215),e(5,2,20735),s=new PIXI.filters.BlurFilter,s.blur=32,a=this.team,o=0,h=a.length;h>o;o++)p=a[o],u=""+p.point,t=16777215,c=(p.base.x+.5)*this.gridSize,l=(p.base.y+.5)*this.gridSize,p.scoreborad=this.setupText(c,l,u,"36px Papyrus",t,"center","center"),p.scoreborad2=this.setupText(c,l,u,"36px Papyrus",p.color,"center","center"),p.scoreborad2.filters=[s],p.scoreborad.alpha=.7,p.scoreboradUpdate=function(t){return function(){var e;return e=t.gridSize,function(){return c=(this.base.x+.5)*e,l=(this.base.y+.5)*e,this.scoreborad.text=""+this.point,this.scoreborad2.text=this.scoreborad.text,this.scoreborad.position.x=c-this.scoreborad.width/2,this.scoreborad.position.y=l-this.scoreborad.height/2,this.scoreborad2.position=this.scoreborad.position}}}(this)(),n.addChild(p.scoreborad2),n.addChild(p.scoreborad);return n.blendMode=PIXI.BLEND_MODES.ADD,n.alpha=.7,r.filters=[i],n.addChild(r),n},t.prototype.setupBullet=function(t){var e,i,s,n;return e=new PIXI.Graphics,i=t.pos.x*this.gridSize,s=t.pos.y*this.gridSize,n=t.size*this.gridSize,e.lineStyle(1,this.team[t.team].color).drawCircle(0,0,n),e.position.x=i,e.position.y=s,e},t.prototype.setupUnit=function(t){var e,i,s,n,r,o,h,a,u,p,c;return e=new PIXI.Graphics,i=t.pos.x*this.gridSize,s=t.pos.y*this.gridSize,c=t.size*this.gridSize,n=c,r=0,p=-150*Math.PI/180,o=c*Math.cos(p),h=c*Math.sin(p),p=150*Math.PI/180,a=c*Math.cos(p),u=c*Math.sin(p),e.lineStyle(2,this.team[t.team].color).moveTo(n,r).lineTo(o,h).lineTo(0,0).lineTo(a,u).lineTo(n,r),t.scoreborad=this.setupText(i+1.4*c,s-1.4*c,""+t.hp,"14px Papyrus",16777215,"center","center"),t.scoreboradUpdate=function(t){return function(){var e;return e=t.gridSize,function(){return i=this.pos.x*e,s=this.pos.y*e,c=this.size*e,this.scoreborad.text=""+this.hp,this.scoreborad.position.x=i+1.4*c,this.scoreborad.position.y=s-1.4*c}}}(this)(),this.container.addChild(t.scoreborad),e.position.x=i,e.position.y=s,e.rotation=t.ang*Math.PI/180,e},t.prototype.getNear=function(t,e,i){var s,n,r,o,h,a,u,p,c,l;for(s=void 0,a=e.units,n=0,r=a.length;r>n;n++)p=a[n],u=p.i.pos,c=u.x,l=u.y,o=Math.pow(t.x-c,2)+Math.pow(t.y-l,2),i*i>o&&(h=Math.atan2(l-t.y,c-t.x),s=180*h/Math.PI);return s},t.prototype.updateUnits=function(){var t,e,i,s,n,r,o,h,a,u,p,c;for(h=this.team,a=[],p=e=0,i=h.length;i>e;p=++e)u=h[p],f.rand(8)||this.setEnemydismap(u,this.team[1-p].units),a.push(function(){var e,i,h,a,l,f,d,m,y,v;for(d=u.units,v=[],e=0,i=d.length;i>e;e++){for(c=d[e],c.i.update(function(t){return function(e){return t.addBullet(e)}}(this),function(t){return function(e,i){return t.getNear(e,t.team[1-p],i)}}(this)),this.fix(c.i),m=this.team,l=0,h=m.length;h>l;l++)if(u=m[l],c.i.team!==u.id)for(s=c.i.pos,r=3*c.i.size/4,y=u.bullets,f=0,a=y.length;a>f;f++)t=y[f],n=t.i.pos,o=t.i.size,Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2)<Math.pow(r+o,2)&&(t.i.removeflag=!0,c.i.hp--,c.i.scoreboradUpdate());c.g.position.x=c.i.pos.x*this.gridSize,c.g.position.y=c.i.pos.y*this.gridSize,v.push(c.g.rotation=c.i.shotang*Math.PI/180)}return v}.call(this));return a},t.prototype.updateBullets=function(){var t,e,i,s,n,r,o,h,a,u,p,c,l,f,d,m,y,v,g,b,x;for(d=this.team,g=[],n=0,o=d.length;o>n;n++){for(b=d[n],v=[],m=b.bullets,s=r=0,h=m.length;h>r;s=++r){for(t=m[s],t.i.update(),f=t.i.getCollider(),p=0,a=f.length;a>p;p++)if(l=f[p],y=this.hitCheck(l.x,l.y),e=y.d,i=y.f,0>e)for(t.i.removeflag=!0,c=0,u=i.length;u>c;c++)switch(x=i[c]){case 2:if(0===t.i.team)break;this.team[0].changePoint(-1);break;case 4:if(1===t.i.team)break;this.team[1].changePoint(-1)}t.g.position.x=t.i.pos.x*this.gridSize,t.g.position.y=t.i.pos.y*this.gridSize,t.g.rotation=t.i.rad,t.i.removeflag&&(v.push(s),this.container.removeChild(t.g))}g.push(_.remove(b.bullets,function(t,e){return v.some(function(t){return t===e})}))}return g},t.prototype.update=function(){return this.input.keys.esc&&location.reload(),this.phase()},t}(),e.exports=p},{"../content/data/meta":1,"./brain/attacker":7,"./brain/defender":8,"./brain/human":9,"./bullet":10,"./input":11,"./team":14,"./unit":15,"./util":16,path:2}],5:[function(t,e,i){e.exports={IDOL:0,MOVE:{TOP:1,BOTTOM:2,LEFT:3,RIGHT:4},ATTACK:{AIM:5,FOWARD:6}}},{}],6:[function(t,e,i){var s;s=function(){function t(){}return t.prototype.update=function(t){},t}(),e.exports=s},{}],7:[function(t,e,i){var s,n,r,o,h=function(t,e){function i(){this.constructor=t}for(var s in e)a.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("../util"),r=t("../brain"),s=t("../actions"),n=function(t){function e(t){this.team=t,e.__super__.constructor.call(this),this.prevacts=[]}return h(e,t),e.prototype.update=function(t,i){var n,r,h,a,u,p,c,l,f,d,m,y,v,g,b,x,M,w,z,T,E,O,A,I,C,k,P,V,_;if(e.__super__.update.call(this,t),o.rand(8))return this.prevacts;for(n=[],l=[],I=[-1,0,1],g=0,M=I.length;M>g;g++)for(b=I[g],C=[-1,0,1],x=0,w=C.length;w>x;x++)m=C[x],(0!==m||0!==b)&&l.push([m,b]);if(k=t.pos,V=k.x,_=k.y,O=Math.ceil((V-.5)*this.team.mapresolution),A=Math.ceil((_-.5)*this.team.mapresolution),u=this.team.coredismap[O+A*this.team.mapsize*this.team.mapresolution],p=this.team.coredirmap[O+A*this.team.mapsize*this.team.mapresolution],p>0)if(h=[0,180,90,270],r=(t.ang+360)%360,r===h[p-1])o.rand(5)&&i(t.pos,5)?n.push(s.ATTACK.AIM):n.push(s.ATTACK.FOWARD);else switch(p){case 1:n.push(s.MOVE.RIGHT);break;case 2:n.push(s.MOVE.LEFT);break;case 3:n.push(s.MOVE.BOTTOM);break;case 4:n.push(s.MOVE.TOP)}else if(o.rand(8)){for(E=u,a=[],T=0,z=l.length;z>T;T++)c=l[T],y=O+c[0]+(A+c[1])*this.team.mapsize*this.team.mapresolution,v=O+2*c[0]+(A+2*c[1])*this.team.mapsize*this.team.mapresolution,f=this.team.coredismap[y],d=this.team.coredismap[v],0>f||o.rand(2)&&0>d||(f===E?a.push(c):E>f&&f>2&&(a=[c],E=f));if(0<(P=a.length)&&5>P){switch(c=o.randArray(a),c[0]){case-1:n.push(s.MOVE.LEFT);break;case 1:n.push(s.MOVE.RIGHT)}switch(c[1]){case-1:n.push(s.MOVE.TOP);break;case 1:n.push(s.MOVE.BOTTOM)}}else n.push(o.randArray([s.MOVE.TOP,s.MOVE.BOTTOM,s.MOVE.LEFT,s.MOVE.RIGHT])),n.push(s.ATTACK.AIM)}else n.push(o.randArray([s.MOVE.TOP,s.MOVE.BOTTOM,s.MOVE.LEFT,s.MOVE.RIGHT])),n.push(s.ATTACK.AIM);return this.prevacts=n,n},e}(r),e.exports=n},{"../actions":5,"../brain":6,"../util":16}],8:[function(t,e,i){var s,n,r,o,h=function(t,e){function i(){this.constructor=t}for(var s in e)a.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("../util"),n=t("../brain"),s=t("../actions"),r=function(t){function e(t){this.team=t,e.__super__.constructor.call(this),this.prevacts=[]}return h(e,t),e.prototype.update=function(t,i){var n,r,h,a,u,p,c,l,f,d,m,y,v,g,b,x,M,w,z,T,E,O,A,I,C,k,P,V,_;if(e.__super__.update.call(this,t),o.rand(8))return this.prevacts;for(n=[],c=[],I=[-1,0,1],g=0,M=I.length;M>g;g++)for(b=I[g],C=[-1,0,1],x=0,w=C.length;w>x;x++)m=C[x],(0!==m||0!==b)&&c.push([m,b]);if(k=t.pos,V=k.x,_=k.y,O=Math.ceil((V-.5)*this.team.mapresolution),A=Math.ceil((_-.5)*this.team.mapresolution),d=this.team.enemydismap[O+A*this.team.mapsize*this.team.mapresolution],u=this.team.coredirmap[O+A*this.team.mapsize*this.team.mapresolution],u>0)if(h=[0,180,90,270],r=(t.ang+360)%360,r===h[u-1])o.rand(5)&&i(t.pos)?n.push(s.ATTACK.AIM):n.push(s.ATTACK.FOWARD);else switch(u){case 1:n.push(s.MOVE.RIGHT);break;case 2:n.push(s.MOVE.LEFT);break;case 3:n.push(s.MOVE.BOTTOM);break;case 4:n.push(s.MOVE.TOP)}else if(o.rand(8)&&d>0){for(E=d,a=[],T=0,z=c.length;z>T;T++)p=c[T],y=O+p[0]+(A+p[1])*this.team.mapsize*this.team.mapresolution,v=O+2*p[0]+(A+2*p[1])*this.team.mapsize*this.team.mapresolution,l=this.team.enemydismap[y],f=this.team.enemydismap[v],0>l||o.rand(2)&&0>f||(l===E?a.push(p):E>l&&l>2&&(a=[p],E=l));if(0<(P=a.length)&&5>P){switch(6>d?n.push(s.ATTACK.AIM):n.push(s.ATTACK.FOWARD),p=o.randArray(a),p[0]){case-1:n.push(s.MOVE.LEFT);break;case 1:n.push(s.MOVE.RIGHT)}switch(p[1]){case-1:n.push(s.MOVE.TOP);break;case 1:n.push(s.MOVE.BOTTOM)}}else n.push(o.randArray([s.MOVE.TOP,s.MOVE.BOTTOM,s.MOVE.LEFT,s.MOVE.RIGHT])),n.push(s.ATTACK.AIM)}else n.push(o.randArray([s.MOVE.TOP,s.MOVE.BOTTOM,s.MOVE.LEFT,s.MOVE.RIGHT])),n.push(s.ATTACK.AIM);return this.prevacts=n,n},e}(n),e.exports=r},{"../actions":5,"../brain":6,"../util":16}],9:[function(t,e,i){var s,n,r,o=function(t,e){function i(){this.constructor=t}for(var s in e)h.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},h={}.hasOwnProperty;n=t("../brain"),s=t("../actions"),r=function(t){function e(t){this.input=t,e.__super__.constructor.call(this)}return o(e,t),e.prototype.update=function(t){var i;return e.__super__.update.call(this,t),i=[],this.input.keys.up&&i.push(s.MOVE.TOP),this.input.keys.down&&i.push(s.MOVE.BOTTOM),this.input.keys.right&&i.push(s.MOVE.RIGHT),this.input.keys.left&&i.push(s.MOVE.LEFT),this.input.keys.z&&i.push(s.ATTACK.AIM),i},e}(n),e.exports=r},{"../actions":5,"../brain":6}],10:[function(t,e,i){var s;s=function(){function t(t,e,i,s,n){this.pos=t,this.size=e,this.vel=s,this.parent=n,this.rad=i*Math.PI/180,this.team=this.parent.team,this.r=0}return t.prototype.getCollider=function(){var t,e;return e=45*Math.PI/180,t=[],t.push({x:this.pos.x,y:this.pos.y}),t.push({x:this.pos.x+this.size*Math.cos(this.rad+e),y:this.pos.y+this.size*Math.sin(this.rad+e)}),t.push({x:this.pos.x+this.size*Math.cos(this.rad-e),y:this.pos.y+this.size*Math.sin(this.rad-e)}),t},t.prototype.update=function(){return this.pos.x+=this.vel*Math.cos(this.rad),this.pos.y+=this.vel*Math.sin(this.rad),this.r+=this.vel},t}(),e.exports=s},{}],11:[function(t,e,i){var s,n=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},r={}.hasOwnProperty;s=function(){function t(t){var e,i,s,o,h,a,u,p,c;this.domElement=null!=t?t:document,this.keys={},this.listener={},this.keyMap={8:"backspace",13:"enter",16:"shift",17:"ctrl",18:"alt",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},o=function(t){return function(e,i){return{key:t.keyMap[e]||String.fromCharCode(e).toLowerCase(),status:i}}}(this),i=Bacon.fromEventTarget(this.domElement,"keydown").map(function(t){return function(e){return o.call(t,e.keyCode,!0)}}(this)),s=Bacon.fromEventTarget(this.domElement,"keyup").map(function(t){return function(e){return o.call(t,e.keyCode,!1)}}(this)),i.merge(s).filter(function(t){var e;return e=t.key.charCodeAt(0),e>47&&58>e||e>96&&123>e}).onValue(function(t){return function(e){var i;return t.keys[e.key]=e.status,e.status&&null!=(i=t.listener[e.key])?i.forEach(function(t){return t()}):void 0}}(this)),e=[1,2],h=function(t){return function(i){var s;return s={},e.forEach(function(t){return s[t]=[]}),Bacon.fromEventTarget(t.domElement,i).filter(function(t){var i;return i=t.button,n.call(e,i)>=0}).onValue(function(t){return s[t.button].forEach(function(e){return e(t.clientX,t.clientY)})}),[function(t,e){var i;return null!=(i=s[t])?i.push(e):void 0},function(t,e){return _.remove(s[t],function(t){return null!=e?t===e:!0})}]}}(this),a=h("mousedown"),this.onMouseDown=a[0],this.offMouseDown=a[1],u=h("mouseup"),this.onMouseUp=u[0],this.offMouseUp=u[1],p=_.transform(h("dblclick"),function(t,e){return t.push(e.bind(this,1))}),this.onDoubleClick=p[0],this.offDoubleClick=p[1],c=function(t){return function(){var i,s,n,o;return s={},i={},e.forEach(function(t){return i[t]=!1,s[t]=[]}),n=Bacon.fromEventTarget(t.domElement,"mousedown").map(function(t){return[t.button,!0]}),o=Bacon.fromEventTarget(t.domElement,"mouseup").map(function(t){return[t.button,!1]}),n.merge(o).onValue(function(t){return null!=i[t[0]]?i[t[0]]=t[1]:void 0}),Bacon.fromEventTarget(t.domElement,"mousemove").onValue(function(t){var e,n,o;n=[];for(e in s)r.call(s,e)&&(o=s[e],n.push(o.forEach(function(s){return i[e]?s(t.clientX,t.clientY):void 0})));return n}),[function(t,e){var i;return null!=(i=s[t])?i.push(e):void 0},function(t,e){return _.remove(s[t],function(t){return null!=e?t===e:!0})}]}}(this)(),this.onMouseMove=c[0],this.offMouseMove=c[1],this.offAll=function(t){return function(){return e.forEach(function(e){return t.offMouseDown(e),t.offMouseUp(e),t.offMouseMove(e)}),t.offDoubleClick(),t.listener={}}}(this)}return t.prototype.on=function(t,e){return this.listener[t]?this.listener[t].push(e):this.listener[t]=[e]},t.prototype.off=function(t,e){return _.remove(this.listener[t],function(t){return t===e})},t}(),e.exports=s},{}],12:[function(t,e,i){"use strict";var s,n,r;n=t("./view"),r=t("./World"),s=function(){function t(){this.view=new n,this.world=new r(this.view.container,this.view.size)}return t.prototype.loop=function(){return requestAnimationFrame(function(t){return function(){return t.loop()}}(this)),this.view.render(function(t){return function(){return t.world.update()}}(this))},t}(),$(function(){return(new s).loop()})},{"./World":4,"./view":17}],13:[function(t,e,i){e.exports={INIT:0,READY:1,ACTIVE:2,DEAD:3}},{}],14:[function(t,e,i){var s;s=function(){function t(t,e,i,s,n){this.id=t,this.base=e,this.core=i,this.color=s,this.point=null!=n?n:100,this.units=[],this.bullets=[]}return t.prototype.changePoint=function(t){return this.point+=t,this.point=Math.max(0,this.point),this.scoreboradUpdate()},t.prototype.eachMembers=function(t){var e,i,s,n,r;for(s=this.units,n=[],e=0,i=s.length;i>e;e++)r=s[e],n.push(t(r));return n},t}(),e.exports=s},{}],15:[function(t,e,i){var s,n,r,o;s=t("./actions"),n=t("./status"),o=t("./util"),r=function(){function t(t,e,i){this.team=t,this.base=e,this.brain=i,this.pos={x:0,y:0},this.ang=this.team%2?180:0,this.shotang=0,this.fullhp=5,this.hp=this.fullhp,this.size=.2,this.vel=0,this.shotInterval=0,this.status=n.ACTIVE,this.respawnCount=0}return t.prototype.getCollider=function(){var t,e;return t=[],e=this.ang*Math.PI/180,t.push({x:this.pos.x+this.size*Math.cos(e),y:this.pos.y+this.size*Math.sin(e)}),t},t.prototype.action=function(t,e,i){var n,r,o,h,a,u,p,c;for(p=0,o=!1,c=!1,h=[void 0,-90,90,void 0,180,-135,135,180,0,-45,45,0,void 0,-90,90,void 0],a=0,u=t.length;u>a;a++)switch(r=t[a]){case s.MOVE.TOP:p+=1;break;case s.MOVE.BOTTOM:p+=2;break;case s.MOVE.LEFT:p+=4;break;case s.MOVE.RIGHT:p+=8;break;case s.ATTACK.AIM:o=!0,c=!0;break;case s.ATTACK.FOWARD:c=!0}return null!=h[p]?(this.ang=h[p],this.vel=o?.03:.06):this.vel=0,this.shotang=this.ang,this.shotInterval>0&&this.shotInterval--,c&&0===this.shotInterval?(o&&(n=i(this.pos,5),n&&(this.shotang=n)),this.shotInterval=20,e(this)):void 0},t.prototype.update=function(t,e){var i;switch(this.status){case n.READY:0===this.respawnCount?(this.status=n.ACTIVE,this.pos.x=this.base.x+o.randf(1),this.pos.y=this.base.y+o.randf(1),this.hp=this.fullhp,this.ang=this.team%2?180:0):this.respawnCount--;break;case n.ACTIVE:this.action(this.brain.update(this,e),t,e),i=this.ang*Math.PI/180,this.pos.x+=this.vel*Math.cos(i),this.pos.y+=this.vel*Math.sin(i),this.vel=.7*this.vel,this.vel*this.vel<1e-4&&(this.vel=0),this.hp<=0&&(this.status=n.DEAD);break;case n.DEAD:this.pos.x=-100,this.pos.y=-100,this.status=n.READY,this.respawnCount=180}return this.scoreboradUpdate()},t}(),e.exports=r},{"./actions":5,"./status":13,"./util":16}],16:[function(t,e,i){var s;s=function(){function t(){}return t.rand=function(t){return Math.floor(Math.random()*t)},t.randf=function(t){return Math.random()*t},t.randRange=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},t.randArray=function(t){return t[Math.floor(Math.random()*t.length)]},t}(),e.exports=s},{}],17:[function(t,e,i){var s;s=function(){function t(){this.size=640,this.renderer=PIXI.autoDetectRenderer(this.size,this.size,{backgroundColor:0,antialias:!0}),$(document.body).append(this.renderer.view),this.container=new PIXI.Container,this.stats=new Stats,this.stats.setMode(0),this.stats.domElement.style.position="absolute",this.stats.domElement.style.right="0px",this.stats.domElement.style.top="0px",$(document.body).append(this.stats.domElement)}return t.prototype.render=function(t){return this.stats.begin(),t(),this.renderer.render(this.container),this.stats.end()},t}(),e.exports=s},{}]},{},[12]);
//# sourceMappingURL=bundle.js.map