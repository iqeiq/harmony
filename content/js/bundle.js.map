{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","bundle.js","node_modules/browserify/node_modules/path-browserify/index.js","node_modules/browserify/node_modules/process/browser.js","src/World.coffee","src/actions.coffee","src/brain.coffee","src/brain/human.coffee","src/input.coffee","src/main.coffee","src/types.coffee","src/unit.coffee","src/util.coffee","src/view.coffee"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length",1,"module","process","normalizeArray","parts","allowAboveRoot","up","last","splice","unshift","filter","xs","res","push","splitPathRe","splitPath","filename","exec","slice","resolve","resolvedPath","resolvedAbsolute","arguments","path","cwd","TypeError","charAt","split","p","join","normalize","isAbsolute","trailingSlash","substr","paths","Array","prototype","index","relative","from","to","trim","arr","start","end","fromParts","toParts","Math","min","samePartsLength","outputParts","concat","sep","delimiter","dirname","result","root","dir","basename","ext","extname","str","len","this","_process",2,"cleanUpNextTick","draining","currentQueue","queue","queueIndex","drainQueue","timeout","setTimeout","run","clearTimeout","Item","fun","array","noop","nextTick","args","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","binding","name","chdir","umask",3,"HumanBrain","Input","TYPE","Unit","World","util","bind","fn","me","size1","humanBrain","j","k","len1","mapstr","ref","ref1","v","size","render","size2","field","Uint8Array","dismap","Int32Array","plInfmap","Float32Array","enInfmap","replace","parseInt","input","player","UNIT","PLAYER","hitCheck","x","y","d","rx","ry","floor","fix","unit","poss","rad","results","getCollider","ang","PI","pos","cos","sin","vel","drawGrid","ctx","viewSize","strokeStyle","beginPath","moveTo","gridSize","lineTo","stroke","drawField","draw","_this","type","color","some","drawUnit","p0x","p0y","p1x","p1y","p2x","p2y","p3x","p3y","fillStyle","lineWidth","fill","update","./brain/human","./input","./types","./unit","./util",4,"MOVE","TOP","BOTTOM","LEFT","RIGHT","ATTACK","AIM","FOWARD",5,"Brain",6,"ACTION","extend","child","parent","ctor","constructor","key","hasProp","__super__","hasOwnProperty","superClass","acts","keys","../actions","../brain",7,"indexOf","item","domElement","buttons","keydown","keyup","mapper","mouseEvent","ref2","ref3","document","listener","keyMap",8,13,16,17,18,27,32,37,38,39,40,"keycode","status","String","fromCharCode","toLowerCase","Bacon","fromEventTarget","map","keyCode","merge","charCodeAt","onValue","forEach","button","clientX","clientY","btn","cb","_","remove","onMouseDown","offMouseDown","onMouseUp","offMouseUp","transform","onDoubleClick","offDoubleClick","active","md","mu","onMouseMove","offMouseMove","offAll","ref4","allremove","Main","View","view","world","loop","requestAnimationFrame","$","./World","./view",9,"FELLOW","ENEMY",10,"brain","shotang","colls","action","actions","act","aimflag","angs","moveflag","shotflag","./actions",11,"Utility","rand","random","randf","randRange","max","randArray",12,"canvas","getElementById","backcanvas","createElement","style","visibility","getContext","backctx","window","resize","stats","Stats","setMode","position","left","top","body","append","height","width","innerWidth","innerHeight","updater","begin","clearRect","fillRect","drawImage"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",null,"// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// Split a filename into [root, dir, basename, ext], unix version\n// 'root' is just a slash, or nothing.\nvar splitPathRe =\n    /^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;\nvar splitPath = function(filename) {\n  return splitPathRe.exec(filename).slice(1);\n};\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function(path) {\n  var result = splitPath(path),\n      root = result[0],\n      dir = result[1];\n\n  if (!root && !dir) {\n    // No dirname whatsoever\n    return '.';\n  }\n\n  if (dir) {\n    // It has a dirname, strip trailing slash\n    dir = dir.substr(0, dir.length - 1);\n  }\n\n  return root + dir;\n};\n\n\nexports.basename = function(path, ext) {\n  var f = splitPath(path)[2];\n  // TODO: make this comparison case-insensitive on windows?\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\n\nexports.extname = function(path) {\n  return splitPath(path)[3];\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = setTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    clearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","path = require 'path'\r\nfs = require 'fs'\r\n\r\nTYPE = require './types'\r\nutil = require './util'\r\nInput = require './input'\r\nUnit = require './unit'\r\nHumanBrain = require './brain/human'\r\n\r\nclass World\r\n\r\n  constructor: (@size = 32)->\r\n    @size2 = @size * @size\r\n\r\n    @field = new Uint8Array @size2\r\n    @dismap = new Int32Array @size2\r\n    @plInfmap = new Float32Array @size2\r\n    @enInfmap = new Float32Array @size2\r\n\r\n    mapstr = fs.readFileSync path.resolve(__dirname, '../content/data/field1.txt'), 'utf8'\r\n    mapstr = mapstr.replace /\\r*\\n/g, ''\r\n    for v, i in @field\r\n      @field[i] = parseInt mapstr.charAt(i)\r\n\r\n    for v, i in @dismap\r\n      @dismap[i] = if @field[i] is 0 then 1 else -1\r\n\r\n    @input = new Input\r\n    humanBrain = new HumanBrain @input\r\n    @player = new Unit @size / 2, @size / 2, TYPE.UNIT.PLAYER, humanBrain\r\n\r\n  hitCheck: (x, y)->\r\n    return -2 if x < 0.5 or y < 0.5\r\n    return -2 if x > @size - 0.5 or y > @size - 0.5\r\n    index = Math.floor(x - 0.5) + @size * Math.floor(y - 0.5)\r\n    rx = x - 0.5 - Math.floor(x - 0.5)\r\n    ry = y - 0.5 - Math.floor(y - 0.5)\r\n    rx = 0 if rx < 0.0001\r\n    ry = 0 if ry < 0.0001\r\n    d = [\r\n      @dismap[index],\r\n      @dismap[index + 1],\r\n      @dismap[index + @size],\r\n      @dismap[index + @size + 1]\r\n    ]\r\n    return (1 - rx) * (1 - ry) * d[0] + (1 - rx) * ry * d[2] + rx * (1 - ry) * d[1] + rx * ry * d[3]\r\n    \r\n  fix: (unit)->\r\n    poss = unit.getCollider()\r\n    for p in poss\r\n      d = @hitCheck p.x, p.y\r\n      if d < 0\r\n        rad = (unit.ang + 180) * Math.PI / 180\r\n        unit.pos.x -= d * Math.cos rad\r\n        unit.pos.y -= d * Math.sin rad\r\n        unit.vel = 0.0\r\n\r\n    \r\n  drawGrid: (ctx, viewSize)->\r\n    ctx.strokeStyle = 'rgb(92, 92, 92)'\r\n    \r\n    for x in [0...@size]\r\n      ctx.beginPath()\r\n      ctx.moveTo x * @gridSize, 0\r\n      ctx.lineTo x * @gridSize, viewSize\r\n      ctx.stroke()\r\n\r\n    for y in [0...@size]\r\n      ctx.beginPath()\r\n      ctx.moveTo 0, y * @gridSize\r\n      ctx.lineTo viewSize, y * @gridSize\r\n      ctx.stroke()\r\n\r\n  drawField: (ctx)->\r\n    \r\n    draw = (type, color)=>\r\n      ctx.strokeStyle = color\r\n      ctx.beginPath()\r\n\r\n      for v, i in @dismap\r\n        x = i % @size\r\n        y = i / @size | 0\r\n        continue if x > @size - 2\r\n        break if y > @size - 2 \r\n        d = [@dismap[i], @dismap[i + 1], @dismap[i + @size], @dismap[i + @size + 1]]\r\n        f = [@field[i], @field[i + 1], @field[i + @size], @field[i + @size + 1]]\r\n      \r\n        continue unless f.some((v)-> v is type)\r\n      \r\n        p = []\r\n        p.push {x: x + 0.5, y: y} if d[0] * d[1] < 0\r\n        p.push {x: x, y: y + 0.5} if d[0] * d[2] < 0\r\n        p.push {x: x + 1.0, y: y + 0.5} if d[1] * d[3] < 0\r\n        p.push {x: x + 0.5, y: y + 1.0} if d[2] * d[3] < 0\r\n        continue unless p.length is 2\r\n      \r\n        ctx.moveTo (p[0].x + 0.5) * @gridSize, (p[0].y + 0.5) * @gridSize\r\n        ctx.lineTo (p[1].x + 0.5) * @gridSize, (p[1].y + 0.5) * @gridSize\r\n\r\n      ctx.stroke()\r\n\r\n    draw 1, 'rgb(0, 255, 128)'\r\n    draw 2, 'rgb(255, 128, 0)'\r\n    draw 3, 'rgb(255, 48, 0)'\r\n    draw 4, 'rgb(0, 160, 255)'\r\n    draw 5, 'rgb(0, 92, 255)'\r\n\r\n  drawUnit: (ctx, unit)->\r\n    ctx.strokeStyle = 'rgb(0, 255, 255)'\r\n    ctx.fillStyle = 'rgb(0, 0, 0)'\r\n    ctx.beginPath()\r\n    ctx.lineWidth = 2\r\n\r\n    \r\n    p0x = unit.pos.x * @gridSize\r\n    p0y = unit.pos.y * @gridSize\r\n    size = unit.size * @gridSize\r\n\r\n    rad = unit.ang * Math.PI / 180\r\n    p1x = p0x + size * Math.cos rad\r\n    p1y = p0y + size * Math.sin rad\r\n\r\n    #console.log @getDistance(unit.pos.x + unit.size * Math.cos(rad), unit.pos.y + unit.size * Math.sin(rad))\r\n\r\n    rad = (unit.ang - 150) * Math.PI / 180\r\n    p2x = p0x + size * Math.cos rad\r\n    p2y = p0y + size * Math.sin rad\r\n\r\n    rad = (unit.ang + 150) * Math.PI / 180\r\n    p3x = p0x + size * Math.cos rad\r\n    p3y = p0y + size * Math.sin rad\r\n    \r\n    rad = unit.ang * Math.PI / 180\r\n    ctx.moveTo p1x, p1y\r\n    ctx.lineTo p2x, p2y\r\n    ctx.lineTo p0x, p0y\r\n    ctx.lineTo p3x, p3y\r\n    ctx.lineTo p1x, p1y\r\n\r\n    ctx.fill()\r\n    ctx.stroke()\r\n\r\n    \r\n\r\n  update: ->\r\n    @player.update()\r\n    @fix @player\r\n\r\n\r\n  render: (ctx, viewSize)=>\r\n    @gridSize = viewSize / @size\r\n    @drawField ctx\r\n    @drawUnit ctx, @player\r\n\r\nmodule.exports = World\r\n","module.exports = \r\n  MOVE:\r\n    TOP:    0\r\n    BOTTOM: 1\r\n    LEFT:   2\r\n    RIGHT:  3\r\n  ATTACK:\r\n    AIM:    7\r\n    FOWARD: 8","class Brain\r\n  constructor: ()->\r\n\r\n\r\n  update: (unit)->\r\n\r\n\r\nmodule.exports = Brain\r\n","Brain = require '../brain'\r\nACTION = require '../actions'\r\n\r\nclass HumanBrain extends Brain\r\n  constructor: (@input)->\r\n    super()\r\n\r\n\r\n  update: (unit)->\r\n    super unit\r\n    acts = []  \r\n\r\n    if @input.keys['up']\r\n      acts.push ACTION.MOVE.TOP\r\n    if @input.keys['down']\r\n      acts.push ACTION.MOVE.BOTTOM\r\n    if @input.keys['right']\r\n      acts.push ACTION.MOVE.RIGHT\r\n    if @input.keys['left']\r\n      acts.push ACTION.MOVE.LEFT\r\n    if @input.keys['z']\r\n      acts.push ACTION.ATTACK.AIM\r\n      \r\n    \r\n    acts\r\n\r\nmodule.exports = HumanBrain","class Input\r\n  constructor: (@domElement = document)->\r\n    @keys = {}\r\n    @listener = {}\r\n\r\n    @keyMap =\r\n      8: 'backspace'\r\n      13: 'enter'\r\n      16: 'shift'\r\n      17: 'ctrl'\r\n      18: 'alt'\r\n      27: 'esc'\r\n      32: 'space'\r\n      37: 'left'\r\n      38: 'up'\r\n      39: 'right'\r\n      40: 'down'\r\n\r\n    mapper = (keycode, status)=>\r\n      key: @keyMap[keycode] or String.fromCharCode(keycode).toLowerCase()\r\n      status: status\r\n\r\n    keydown = Bacon.fromEventTarget(@domElement, 'keydown').map (e)=> mapper.call @, e.keyCode, true\r\n    keyup = Bacon.fromEventTarget(@domElement, 'keyup').map (e)=> mapper.call @, e.keyCode, false\r\n    keydown.merge(keyup).filter (e)->\r\n      code = e.key.charCodeAt 0\r\n      47 < code < 58 or 96 < code < 123\r\n    .onValue (e)=>\r\n      @keys[e.key] = e.status\r\n      return unless e.status \r\n      @listener[e.key]?.forEach (v)-> do v\r\n\r\n    buttons = [1, 2]\r\n    \r\n    mouseEvent = (type)=>\r\n      listener = {}\r\n      buttons.forEach (e)-> listener[e] = []\r\n      Bacon.fromEventTarget @domElement, type\r\n        .filter (e)-> e.button in buttons\r\n        .onValue (e)-> listener[e.button].forEach (v)-> v e.clientX, e.clientY\r\n      [ \r\n        (btn, cb)-> listener[btn]?.push cb,\r\n        (btn, cb)-> _.remove listener[btn], (v)-> if cb? then v is cb else true\r\n      ]\r\n\r\n    [@onMouseDown, @offMouseDown] = mouseEvent 'mousedown'\r\n    [@onMouseUp, @offMouseUp] = mouseEvent 'mouseup'\r\n    [@onDoubleClick, @offDoubleClick] = _.transform mouseEvent('dblclick'), (res, e)-> res.push e.bind @, 1\r\n\r\n    [@onMouseMove, @offMouseMove] = do =>\r\n      listener = {}\r\n      active = {}\r\n      buttons.forEach (e)-> \r\n        active[e] = false\r\n        listener[e] = []\r\n      md = Bacon.fromEventTarget(@domElement, 'mousedown').map (e)-> [e.button, true]\r\n      mu = Bacon.fromEventTarget(@domElement, 'mouseup').map (e)-> [e.button, false]\r\n      md.merge(mu).onValue (e)-> active[e[0]] = e[1] if active[e[0]]?\r\n      Bacon.fromEventTarget(@domElement, 'mousemove').onValue (e)->\r\n        for own k, v of listener\r\n          v.forEach (u)-> u e.clientX, e.clientY if active[k] \r\n      [\r\n        (btn, cb)-> listener[btn]?.push cb,\r\n        (btn, cb)-> _.remove listener[btn], (v)-> if cb? then v is cb else true\r\n      ]\r\n\r\n    @offAll = =>\r\n      buttons.forEach (v)=>\r\n        @offMouseDown v\r\n        @offMouseUp v\r\n        @offMouseMove v\r\n      @offDoubleClick()\r\n      @off k for own k, v of @listener\r\n        \r\n\r\n  on: (key, cb)->\r\n    return @listener[key].push cb if @listener[key]\r\n    @listener[key] = [cb]\r\n\r\n  off: (key, cb = allremove)->\r\n    _.remove @listener[key], (v)-> v is cb\r\n\r\n\r\nmodule.exports = Input","'use strict'\r\n\r\nView = require './view'\r\nWorld = require './World'\r\n\r\nclass Main \r\n  constructor: ->\r\n    @view = new View\r\n    @world = new World\r\n    \r\n  loop: ->\r\n    requestAnimationFrame => do @loop\r\n    @world.update()\r\n    @view.render @world.render\r\n\r\n\r\n$ -> do new Main().loop\r\n","module.exports = \r\n  UNIT:\r\n    PLAYER: 0\r\n    FELLOW: 1\r\n    ENEMY:  2","TYPE = require './types'\r\nACTION = require './actions'\r\n\r\nclass Unit \r\n  constructor: (x, y, @type, @brain)->\r\n    @pos = \r\n      x: x\r\n      y: y\r\n    @ang = 0\r\n    @shotang = 0.0\r\n    @size = 0.2\r\n    @vel = 0.0\r\n\r\n  getCollider: ->\r\n    colls = []\r\n    rad = @ang * Math.PI / 180\r\n    colls.push\r\n      x: @pos.x + @size * Math.cos rad\r\n      y: @pos.y + @size * Math.sin rad\r\n    ###\r\n    rad = (@ang - 150) * Math.PI / 180\r\n    colls.push\r\n      x: @pos.x + @size * Math.cos rad\r\n      y: @pos.y + @size * Math.sin rad\r\n    rad = (@ang + 150) * Math.PI / 180\r\n    colls.push\r\n      x: @pos.x + @size * Math.cos rad\r\n      y: @pos.y + @size * Math.sin rad\r\n    ###\r\n    colls\r\n\r\n  action: (actions)->\r\n    moveflag = 0\r\n    aimflag = false\r\n    shotflag = false\r\n    angs = [undefined, -90, 90, undefined, 180, -135, 135, 180, 0, -45, 45, 0, undefined, -90, 90, undefined]\r\n    for act in actions\r\n      switch act\r\n        when ACTION.MOVE.TOP\r\n          moveflag += 1\r\n        when ACTION.MOVE.BOTTOM\r\n          moveflag += 2\r\n        when ACTION.MOVE.LEFT\r\n          moveflag += 4\r\n        when ACTION.MOVE.RIGHT\r\n          moveflag += 8  \r\n        when ACTION.ATTACK.AIM\r\n          aimflag = true\r\n          shotflag = true\r\n        when ACTION.ATTACK.FOWARD\r\n          shotflag = true\r\n    if angs[moveflag]?\r\n      @ang = angs[moveflag]\r\n      @vel = if aimflag then 0.04 else 0.07\r\n    else\r\n      @vel = 0\r\n\r\n    if shotflag\r\n      0 #TODO\r\n\r\n  update: ()->\r\n    @action @brain.update(@)\r\n\r\n    rad = @ang * Math.PI / 180\r\n    @pos.x += @vel * Math.cos rad\r\n    @pos.y += @vel * Math.sin rad\r\n    @vel = @vel * 0.7\r\n    @vel = 0.0 if @vel * @vel < 0.0001\r\n\r\n  draw: (ctx)->\r\n    ctx.strokeStyle = 'rgb(0, 92, 192)'\r\n    ctx.beginPath()\r\n    \r\n    rad = @ang * Math.PI / 180\r\n    p1x = @pos.x + @size * Math.cos rad\r\n    p1y = @pos.y + @size * Math.sin rad\r\n\r\n    rad = (@ang - 60) * Math.PI / 180\r\n    p2x = @pos.x + @size * Math.cos rad\r\n    p2y = @pos.y + @size * Math.sin rad\r\n\r\n    rad = (@ang + 60) * Math.PI / 180\r\n    p3x = @pos.x + @size * Math.cos rad\r\n    p3y = @pos.y + @size * Math.sin rad\r\n    \r\n    rad = @ang * Math.PI / 180\r\n    ctx.moveTo p1x, p1y\r\n    ctx.lineTo p2x, p2y\r\n    ctx.lineTo @pos.x, @pos.y\r\n    ctx.lineTo p3x, p3y\r\n    ctx.lineTo p1x, p1y\r\n\r\n    ctx.stroke()\r\n\r\n\r\nmodule.exports = Unit\r\n","class Utility\r\n  @rand = (n)->\r\n    Math.floor Math.random() * n\r\n\r\n  @randf = (n)->\r\n    Math.random() * n\r\n\r\n  @randRange = (min, max)->\r\n    Math.floor(Math.random() * (max - min + 1)) + min\r\n  \r\n  @randArray = (arr)->\r\n    arr[Math.floor Math.random() * arr.length]\r\n\r\n\r\nmodule.exports = Utility","class View\r\n  constructor: ->\r\n    @canvas = document.getElementById 'view'\r\n    @backcanvas = document.createElement 'canvas'\r\n    @backcanvas.style.visibility = 'hidden'\r\n\r\n    @ctx = @canvas.getContext '2d'\r\n    @backctx = @backcanvas.getContext '2d'\r\n    \r\n    @update()\r\n    \r\n    $(window).resize =>\r\n      @update()\r\n\r\n    @stats = new Stats\r\n    @stats.setMode 0  # 0: fps, 1: ms, 2: mb\r\n    @stats.domElement.style.position = 'absolute'\r\n    @stats.domElement.style.left = '0px'\r\n    @stats.domElement.style.top = '0px'\r\n    $(document.body).append @stats.domElement\r\n    \r\n  update: ->\r\n    width = window.innerWidth\r\n    height = window.innerHeight\r\n    @viewSize = Math.min width, height\r\n    @canvas.width = @viewSize\r\n    @canvas.height = @viewSize\r\n    @backcanvas.width = @viewSize\r\n    @backcanvas.height = @viewSize\r\n\r\n  render: (updater)->\r\n    @stats.begin()\r\n    @backctx.clearRect 0, 0, @backcanvas.width, @backcanvas.height\r\n    @backctx.fillStyle = \"black\"\r\n    @backctx.fillRect 0, 0, @viewSize, @viewSize\r\n    @backctx.fill()\r\n    updater @backctx, @viewSize\r\n    @ctx.drawImage @backcanvas, 0, 0\r\n    @stats.end()\r\n\r\n\r\nmodule.exports = View\r\n"],"sourceRoot":"./src"}